<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>yanxlg@blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.yanxlg.cn/"/>
  <updated>2020-07-03T11:29:45.247Z</updated>
  <id>https://blog.yanxlg.cn/</id>
  
  <author>
    <name>yanxlg</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>h5/knowledge</title>
    <link href="https://blog.yanxlg.cn/caee5929/"/>
    <id>https://blog.yanxlg.cn/caee5929/</id>
    <published>2020-06-13T09:12:38.662Z</published>
    <updated>2020-07-03T11:29:45.247Z</updated>
    
    <content type="html"><![CDATA[<p>JSON 中 数字 key会进行顺序重拍</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;JSON 中 数字 key会进行顺序重拍&lt;/p&gt;

      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>React Library</title>
    <link href="https://blog.yanxlg.cn/dab1a7fa/"/>
    <id>https://blog.yanxlg.cn/dab1a7fa/</id>
    <published>2020-06-02T07:31:52.000Z</published>
    <updated>2020-06-02T07:38:30.534Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文主要收录React中常用的第三方库及其作用描述，收录相关组件搜索网站</p><h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><blockquote><p><code>react-dnd</code>：h5中拖拽（drag）效果封装，可以轻松实现拖动效果<br><code>react-beautiful-dnd</code>：体验较好的拖拽(drag)功能实现，基于<code>react-dnd</code>封装，支持动画，通常用于列表排序等</p></blockquote><h2 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h2><ol><li><a href="https://js.coach/" target="_blank" rel="noopener">https://js.coach/</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;本文主要收录React中常用的第三方库及其作用描述，收录相关组件搜索网站&lt;/p&gt;
&lt;h2 id=&quot;Libraries&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
      <category term="react" scheme="https://blog.yanxlg.cn/categories/react/"/>
    
    
  </entry>
  
  <entry>
    <title>flutter</title>
    <link href="https://blog.yanxlg.cn/2a2a7e8a/"/>
    <id>https://blog.yanxlg.cn/2a2a7e8a/</id>
    <published>2020-06-02T07:17:52.000Z</published>
    <updated>2020-06-02T07:17:53.021Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>可视化编辑器</title>
    <link href="https://blog.yanxlg.cn/2ed7d141/"/>
    <id>https://blog.yanxlg.cn/2ed7d141/</id>
    <published>2020-06-01T02:18:52.000Z</published>
    <updated>2020-06-02T05:56:48.325Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="0b5cc243eb172c661740ddbac8b5bebd5487bc5b24b8665e9fe2b72955543e4a">76a7c2d69f910a96efe6d4a85086bd083b71be6382a756a0ea08c2f18f8205b2dc5f7b340d04aefbcab27741555ea0fefdf4afea40a8d8f3349545a73a10a806f501c971e515c7af4c7987e626c74cdc3b987ba38db7b75c4be0ddfa926373406edddf9265d9662fd201e74d620f8712e407aeac72b229c1ba95b40fc5db1f26cf4f5893123889db965053e7253805d21354adb326a9fbd0d82787c02be26a01a31d8538059fb7fa4aa50995e97e068e396f584f5d1cdbfc5de152ae0f2f32c412772b421d219524055c19832158f5f3a5eb0ad32ae10d822833715d9cd3b0ed26f9588939d983cff98a51de9c4aa31ca76f20790ee5d8c40a6304fc269fddebcd26596539ee40e913980393934f1dd23ea0ee0c029ad07b8e02847e3b7d2c9e0640525d93db459135f7b446f9f970a868628a66be2d37c30bef8d1ac6d98e107f2f4e695f5d7493eee29df46e6c228699a321ee3b92419281b421b6be748db3bba8fa0f3a7867d889e4f12bfd821477f8b249bb65aeeeb1ef09c55186eea0dae3420a1925dfef26ae9d9734cfbd884dff69f995bb98dd8c2d424d733f60aebc0b1ee9545227c1bf455501518a38a808b380b75fde7d59e0ee9628283571fbac48f2bdf63f2b1a5c7477981a3085051183effafa37a016abc0b1af517e97c6d25786f3d75e72d72d638a7aadc022e56906a54f93d431cbf556f0bde3e5b00b8bf6c41386537b47368d73dd891b88fc04674f62fa012400e28ba5482b92a96eaa57d034b597aabe3f4ecf6b455ef83df23fc35cee7a0ff9eb0167923b51e800cc72dd2b63f0043922e88c87468e1a0f5c99123c0efdb4035e392936105547a5589fa8cce70ccf1854c2782cef472b66b8db593f784433544580f6fdc84812f62b9eddd927da31596818531509b05bd57c09143b669fa03c2b35ad4d7fcf1ae90b809c38bc38a0b6eb90445a225fc2ac38af468cdc0abe3e4010b88921557a3cd41a4d1fe658a8822f80ef735ae5d5649cbc49ebe2c65852fc8cc636d68601d1d8317ad577fbb5da78b5277b5a1d69a3137a92ed60f3850f8a50bfe03fbb331e1eb91ad03aaa38f3226f3bc40838f8ba0254a71d422ad5326411f0bbc4afc5fd59abd0f38cb3c5abf84ae8c061d2146f2d65517445ffe6b750ffcb2c4cf21db7aac33bc2d6926ad38417f2b3de304b5969d1fbabd47e4b2d06e4c613e2a0226988569c444bd9f0e5539feb4a1e9599d24bf0c954c7e05b6cf211804828db07ad2dad43af0b5a7843764fbbf90498a37c73cb2871425c5eb85904328a1a9c19e4f1e45b4d04de8204992db2c6709208d0e6801dc47e451020142c709d63319590d8c0e30583bcc0dcd8255a3f15c17be41103999e89f6d26da90fff9873edd94be8e12671c0353fded312540b6e0532b63245b8a4fb1fa58ccf29daab2444d95af24b5bfd31d53554e9fa85bd1af47e5f4d5227d2d0eee5ce3637aa262efab685cb62513092eca4bf603fdb1ba9e11e69ccceca9e695fe47d7cc92bc0221f43311a62b3ec60bfa220a54df248c489a0ac9f4ecc0ca2e75fc8f8974990df4a74ba1682cec540f5a911eb151c671bb153890ce019955511e19c15bb144aec014b4ded97afb41b3b920791d8ef65bed6994970587ff71c861b2e83adc88087c0371150dd018e619818ce5418f15e947cc133d99adbbb095f1621f9f8d665ea91fedf3b4239a534e6dc6bf6800a7648133377e629a85c409a2bcf5bbfdbb3176e94e368d5b2ccc9c8be5a8507ef5ea96329f2eac3b284a024bcfc862237b96c52f877354ce26b4ad7712ed85f067bc098b64993ebc66e8a6c2323d84cfee6e48593079a7ebaf50e30393631056e5e956ef41af214abff36c1d908e77878e5d53bda8b49590d4bc20f5b892debb7177d6b12c97a32f685e4eacf51ac92aa803476ad0d21ef1ceebaef9384cf1865e8766c8ebe9c9d369e2e7f7cfb554a32caa8cd75edf873229cc748021d417f43f6f8881fac5a488373294f8caf75d88a61e8ceb9a55ed045b09eeb3f72eefb0dff0ebd98eccdefbc59b5778831ea7e93437f669fdea9653a21ab78f0232f86aa16ca307536bfe4c02511d52c74b275dc420736696860165637cf79d8bcd8470cddd6d781484a058c67f2e312a2417b03cc97cb9b8a6f65862b0b703cb19c582541f7b26881eca54af4e7db5958adc6f1a28e5a0a88aca9d4f45a42b1961bfeb04b1384422d32073f5b94b55069cd1f410a514b555f53b079199abafb30294576fb971965f3afb7d93deba7d4ef43ccf9bb7b362ade9ba10766352e769ac2cf36ee1a004493aae49c33c0796dca7c41cea54af19f89c57845e4cacd9306750a3d26633cf3218b0146ccd82732ddc72c8ca4981b8b255517fbdce030a4591c24558fd7fe1abd9e9e719899cb1790263524c450b2176300232e6d30bda32cbb18269e8956d8aa152c861f204cf86ee18d9d502d20436f17dfa13e487a3150dc2f3d90befcd553d99d9f606d51e033b169a87e2761c648561a2ab300cdcc4fa9f84f313c42caebcfe24033f3d2bcde1032b24a0cb898e7b9c01eca65afe7a1de8f3aa746a327f775ffb7438a922c9873f81fba7069bc9ca0f5f13118255bdff04553c1f55a00cc6eb63456bbe70493ad81c0feee1845a2b9d40d104cd991daacc5483b14352e8550e364f4d130e571a0c9bfbefe56fcf50d4b88519103868134e6ea99495864e365b03cdd2ad0447e0a1788a792acbe1d4ac5a2edd3731f1dff1cf21ec3c9e9c50993df38bafff70d7d2e3160db49cb925559fa71ababe197264695594148a55a28a07a96033fc25d2a5ffaf389f2e7100917269f7ea8bdead8525fff1488efab5f6e1a79933da3f33ebe601c988e9fbf4bd8e93a36af22536339f807d05e34371aa36d77a692365a160dfd44d913b97f6b898709824c48febf89aaeeabef6064b7ec64a109b5fd5addb4a80d724d987a11a88513065c2706e6245c5151a1d3bd86236a7383bae63fc2c4dc4f9baf83ed251cde5ad084b90e7e3380e89ac1a01b22c8b18e3599c760bfb5073086171281a4bc8b1050c8460e8e1a1a146ba5cda856b3b1394b72d2ae1a3a862b5c879dc64854b9fe734c8f0ebd5356e571e6cd9676d4ff0271fbcea2ceccc4b18d62f1dd8d28073b90125d55b37c6bb37e37ab074b66a92fddb119dfb6a152026ee9241781cef50f9ade5208dff70cf983f3932a1448153c9cf84683662a0d4c9bcfc6c6570702e4ffaaa03184bdce70c8c94d33e62c636b524ea587027c796c05166363f10b7f7f93c75bd6de92204afb8106d5a2641e58cec0fcc15662af01b0dfef54daa892a03adf726dfb47b8b697e4dbad68b953cc6c711cbc92532da8e9a5c367803f707e32fe614d94c891c7bf9a0fa8a37ea2be472381c99e0c5192c78a27f63a974fc92b705fb5fa52d314513d9bb73b492e8d1e2155cecfc79e9d8b534585f8c4d34858440655623292e2045e077899fa81f410cefbee2b76e9422aeb91e2cd1253014bba07e6c637fb1dbf47ffea9da37d9accd197f98e03154d69267f5f4c0a66b0c1ced31b724abc9a82e146c476ca783b43f18205e816a6c9c03a97f2c78af9c20332699884fcff8085ef101844a1723d338816ae6730a53e086afd99f368a12f3e70da7c659eabe0585057614528eb50848cc4ab37a029ab080413fd34b3ae440b2305bd0a67e573cc23ccbad83e14abfe8a104b396af184e36cb921aacc718d678740b22279f31ea5b1afac7a0680318adf6aaab04a0f699c6c69a4982a3ef10268803375245f791d83e8e77b72140b003471be0628b374600cbe79721268316c6807af71680d44993026524a8be1b3ffb407ffadf2a31d3e425a37783e0d6a235232dfb20e6eced22e521c5597ff63e9ecfae8cc1b227f8c558357439859bf2eeb26c75b83804c51b446cd4941af725a999b1a6e2d09b1aa67ce8cb524b97810b5d13f101c7e8c0459e4d851ecbf9d8dce8fcd2e098d1df1ab445b3c21a036ec3c776d9254e2e8ae0d88b8ee073d0440ba53686ce42797d457f98970453443560822d105295489b2cb4bc2c54db47e1d49c97bc97573f1ded53ac1e4f921396c998c8e448465e002002524d0a6dfb9c0b0d526ad8ed3311a92d877ba50837ee224690ba5c917d6784d090b2700fa7cb10899c7804c73ea8ff13e4f2576900b4ff37aa5a3603689369286aa2466fae2559cc80987a1af8a4cc8e3f50533ab75109d8350d8c49a2e1071a827dcf62b7d886326b62c4c853ebea66a91a65598dbafd8c9cb3e9452ccd23e2e6de0f71424e6b9effcba2fe89cb8c1287c7cbb1a8d8f33e01db358a10c94552bf2087e020d5aa35a6240a837a9262e2095f7061407c33a1ddc2e7c775889ade2e8f16da6fa88c60cd880eec921309aae3b14c5ecf231f5654c39130ee0dfd9e5d7f7f7f8e7c70ac4f9c2901073c29ced96dbf1686c6464225481f81e2d854a1c9ccf8e1f5fe70b614fe18f222b6ec808139b4cc2c2e1ee84e2d4c61ebe998d96afcd6707a5105462c2bd86affa4d5919d4d06e996e2a97068c31605ec2dd0d737c5f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>React Debug</title>
    <link href="https://blog.yanxlg.cn/1d2a4632/"/>
    <id>https://blog.yanxlg.cn/1d2a4632/</id>
    <published>2020-05-22T02:28:01.000Z</published>
    <updated>2020-06-01T02:16:38.190Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>React框架一直依赖都比较神秘，其原理大部分人都是通过博客进行了解，但是这种了解有局限性，博客中写的并不一定详细，稍微误差就容易造成理解歧义，而React源码的阅读相对来说比较困难，并不想vue源码一样直观，而我们想要详细了解一个框架源码就必须要对源码进行调试，通常项目中虽然也能调试，但是调试的都是node_modules下的react.development.js，比较难以阅读。本文主要介绍react真实源码的调试方式，通过这种调试我们可以更方便了解React每个package的作用。</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol><li>创建项目：使用create-react-app创建react demo项目<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app --typescript</span><br></pre></td></tr></table></figure></li><li>弹出项目运行配置<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn eject</span><br></pre></td></tr></table></figure></li><li>拉取react源码<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add https://github.com/facebook/react.git react</span><br></pre></td></tr></table></figure>拉取的源码会放在/react目录下</li><li>修改webpack配置文件：<code>config/webpack.config.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">    // Support React Native Web</span><br><span class="line">    // https://www.smashingmagazine.com/2016/08/a-glimpse-into-the-future-with-react-native-for-web/</span><br><span class="line">    'react-native': 'react-native-web',</span><br><span class="line">    // Allows for better profiling with ReactDevTools</span><br><span class="line">    ...(isEnvProductionProfile &amp;&amp; &#123;</span><br><span class="line">        'react-dom$': 'react-dom/profiling',</span><br><span class="line">        'scheduler/tracing': 'scheduler/tracing-profiling',</span><br><span class="line">    &#125;),</span><br><span class="line">    ...(modules.webpackAliases || &#123;&#125;),</span><br><span class="line"></span><br><span class="line"><span class="addition">+  'react': path.resolve(__dirname, '../react/packages/react'),</span></span><br><span class="line"><span class="addition">+  'react-dom': path.resolve(__dirname, '../react/packages/react-dom'),</span></span><br><span class="line"><span class="addition">+  'shared': path.resolve(__dirname, '../react/packages/shared'),</span></span><br><span class="line"><span class="addition">+  'react-reconciler': path.resolve(__dirname, '../react/packages/react-reconciler'),</span></span><br><span class="line"><span class="addition">+  'legacy-events':path.resolve(__dirname, '../react/packages/legacy-events'),</span></span><br><span class="line"><span class="addition">+  'scheduler':path.resolve(__dirname, '../react/packages/scheduler'),</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li>修改环境变量：<code>config/env.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const stringified = &#123;</span><br><span class="line"><span class="addition">+   __DEV__: true,</span></span><br><span class="line"><span class="addition">+   SharedArrayBuffer: true,</span></span><br><span class="line"><span class="addition">+   spyOnDev: true,</span></span><br><span class="line"><span class="addition">+   spyOnDevAndProd: true,</span></span><br><span class="line"><span class="addition">+   spyOnProd: true,</span></span><br><span class="line"><span class="addition">+   __PROFILE__: true,</span></span><br><span class="line"><span class="addition">+   __UMD__: true,</span></span><br><span class="line"><span class="addition">+   __EXPERIMENTAL__: true,</span></span><br><span class="line"><span class="addition">+   __VARIANT__: true,</span></span><br><span class="line"><span class="addition">+   gate: true,</span></span><br><span class="line"><span class="addition">+   trustedTypes: true,</span></span><br><span class="line"></span><br><span class="line">    'process.env': Object.keys(raw).reduce((env, key) =&gt; &#123;</span><br><span class="line">        env[key] = JSON.stringify(raw[key]);</span><br><span class="line">        return env;</span><br><span class="line">    &#125;, &#123;&#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li>忽略React源码中flow类型：<code>/config/webpack.config.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    test: /\.(js|mjs)$/,</span><br><span class="line">    exclude: /@babel(?:\/|\\&#123;1,2&#125;)runtime/,</span><br><span class="line">    loader: require.resolve('babel-loader'),</span><br><span class="line">    options: &#123;</span><br><span class="line">    babelrc: false,</span><br><span class="line">    configFile: false,</span><br><span class="line">    compact: false,</span><br><span class="line">    presets: [</span><br><span class="line">        [</span><br><span class="line">            require.resolve('babel-preset-react-app/dependencies'),</span><br><span class="line">            &#123; helpers: true &#125;,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line"><span class="addition">+   plugins: [</span></span><br><span class="line"><span class="addition">+       require.resolve('@babel/plugin-transform-flow-strip-types'),</span></span><br><span class="line"><span class="addition">+   ],</span></span><br><span class="line">    cacheDirectory: true,</span><br><span class="line">    // See #6846 for context on why cacheCompression is disabled</span><br><span class="line">    cacheCompression: false,</span><br><span class="line"></span><br><span class="line">    // Babel sourcemaps are needed for debugging into node_modules</span><br><span class="line">    // code.  Without the options below, debuggers like VSCode</span><br><span class="line">    // show incorrect code and set breakpoints on the wrong lines.</span><br><span class="line">    sourceMaps: shouldUseSourceMap,</span><br><span class="line">    inputSourceMap: shouldUseSourceMap,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li>webstorm 中Javascript类型选择Flow，解决源码阅读时编辑器错误提示</li><li>解决demo ts代码中<code>react</code>，<code>react-dom</code>类型提示错误<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf react/packages/react/src/__tests__</span><br></pre></td></tr></table></figure></li><li>错误提示<ul><li>scope错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/2.png" alt=""><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    // Adds support for installing with Plug'n'Play, leading to faster installs and adding</span><br><span class="line">    // guards against forgotten dependencies and such.</span><br><span class="line">    PnpWebpackPlugin,</span><br><span class="line">    // Prevents users from importing files from outside of src/ (or node_modules/).</span><br><span class="line">    // This often causes confusion because we only process files within src/ with babel.</span><br><span class="line">    // To fix this, we prevent you from importing files out of src/ -- if you'd like to,</span><br><span class="line">    // please link the files into your node_modules/ and let module-resolution kick in.</span><br><span class="line">    // Make sure your source files are compiled, as they will not be processed in any way.</span><br><span class="line"><span class="deletion">-   new ModuleScopePlugin(paths.appSrc, [paths.appPackageJson]),</span></span><br><span class="line"><span class="addition">+   new ModuleScopePlugin([paths.appSrc,path.resolve(__dirname,'../react')], [paths.appPackageJson]),</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure></li><li>default 引用错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/1.png" alt=""><br>修改demo代码<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- import React from 'react';</span></span><br><span class="line"><span class="deletion">- import ReactDOM from 'react-dom';</span></span><br><span class="line"><span class="addition">+ import * as React from 'react';</span></span><br><span class="line"><span class="addition">+ import * as ReactDOM from 'react-dom';</span></span><br></pre></td></tr></table></figure></li><li>导出 HostConfig<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/3.png" alt=""><br>修改文件 <code>/react/packages/react-reconciler/src/ReactFiberHostConfig.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-  import invariant from 'shared/invariant';</span></span><br><span class="line"></span><br><span class="line">// We expect that our Rollup, Jest, and Flow configurations</span><br><span class="line">// always shim this module with the corresponding host config</span><br><span class="line">// (either provided by a renderer, or a generic shim for npm).</span><br><span class="line">//</span><br><span class="line">// We should never resolve to this file, but it exists to make</span><br><span class="line">// sure that if we *do* accidentally break the configuration,</span><br><span class="line">// the failure isn't silent.</span><br><span class="line"></span><br><span class="line"><span class="deletion">-  invariant(false, 'This module must be shimmed by a specific renderer.');</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ export * from './forks/ReactFiberHostConfig.dom';</span></span><br></pre></td></tr></table></figure></li><li>env错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/4.png" alt=""><br>参考上面env配置</li><li>import错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/5.png" alt=""><br>react 此时还未 <code>export</code>，因此需要直接从<code>ReactSharedInternals</code>取值，修改文件<code>/react/packages/shared/ReactSharedInternals.js</code>。<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ import ReactSharedInternals from '../react/src/ReactSharedInternals'</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- import * as React from 'react';</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- const ReactSharedInternals =</span></span><br><span class="line"><span class="deletion">-   React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;</span></span><br><span class="line"></span><br><span class="line">export default ReactSharedInternals;</span><br></pre></td></tr></table></figure></li><li>invariant错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/6.png" alt=""><br>修改<code>/react/packages/shared/invariant.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default function invariant(condition, format, a, b, c, d, e, f) &#123;</span><br><span class="line"><span class="addition">+   return;</span></span><br><span class="line">    throw new Error(</span><br><span class="line">        'Internal React error: invariant() is meant to be replaced at compile ' +</span><br><span class="line">        'time. There is no runtime version.',</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>scheduler编译错误<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/7.png" alt=""><br>修改<code>/react/packages/scheduler/index.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    export * from './src/Scheduler';</span><br><span class="line"><span class="addition">+   export * from "./src/forks/SchedulerHostConfig.mock";</span></span><br></pre></td></tr></table></figure></li><li>SchedulerHostConfig报错<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./index/8.png" alt=""><br>修改<code>/react/packages/scheduler/src/SchedulerHostConfig.js</code><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+   export * from "./forks/SchedulerHostConfig.mock";</span></span><br><span class="line"><span class="deletion">-   throw new Error('This module must be shimmed by a specific build.');</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><ol><li>demo <a href="https://github.com/yanxlg/react-debug.git" target="_blank" rel="noopener">git地址</a></li><li>版本更新通过git submodule更新即可</li><li>调试方式：网上资料较多，根据自己熟悉的编辑器查找调试方法，或者直接使用浏览器调试</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;React框架一直依赖都比较神秘，其原理大部分人都是通过博客进行了解，但是这种了解有局限性，博客中写的并不一定详细，稍微误差就容易造成理解歧
      
    
    </summary>
    
    
      <category term="react" scheme="https://blog.yanxlg.cn/categories/react/"/>
    
    
  </entry>
  
  <entry>
    <title>events</title>
    <link href="https://blog.yanxlg.cn/5387574a/"/>
    <id>https://blog.yanxlg.cn/5387574a/</id>
    <published>2020-05-22T02:08:24.000Z</published>
    <updated>2020-06-01T02:16:56.122Z</updated>
    
    <content type="html"><![CDATA[<p>React 事件不同与js原声事件，是在其上做了处理，容器外部的元素事件在容器中也能捕获，典型的createPortal创建的元素</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;React 事件不同与js原声事件，是在其上做了处理，容器外部的元素事件在容器中也能捕获，典型的createPortal创建的元素&lt;/p&gt;

      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Mock Server</title>
    <link href="https://blog.yanxlg.cn/9d66f38a/"/>
    <id>https://blog.yanxlg.cn/9d66f38a/</id>
    <published>2020-05-21T08:47:21.000Z</published>
    <updated>2020-06-01T02:14:48.002Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在前端开发转型为前后端分离的今天，敏捷开发越来越重要，前后端分离中敏捷开发最重要的一环就是api mock，前端不需要等待服务端接口开发完成就可以进行业务开发和测试，甚至整个开发过程都可以不需要服务端来保证，只要严格按照定义的文档开发即可，这样大大提升了效率，较少了不同团队之间的沟通，开发过程实现解耦。要实现这样的开发模式，早期都是前端在项目中创建一个个json，用于封装请求库，根据配置去判断是读取本地json还是发送接口到服务端，后来随着mock的出现，该功能变得更加合理化。目前基本每个互联网公司都会自己部署一套内网的mock系统，例如<code>yAPi</code>，但是在线系统基本只能根据配置生成随机数据，而一些数据相关性很难实现，因此现在前端开发更流行的是本地mock server，例如<code>umi</code>和<code>vue</code>都有完善的本地mock server，只需要按照文档创建mock文件就会自动启动mock server，配合<code>proxy</code>可以将正常请求直接转发到mock server，相对于在线的mock系统，本地mock可以实现更加复杂严格的功能，例如数据相关性，数据计算等等。本文主要介绍本地mock server的搭建过程。</p><h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><p>具体的设计思路如下图：</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/9d66f38a/design.png" class="" title="逻辑设计图"><p>由上图可以知道我们最终要的是实现mock缓存池，缓存池中存的是key-value健值对，键为<code>GET /api/xxx</code>或<code>POST /api/xx</code>的格式，由method+url组成，value支持<code>json</code>和<code>koa midway</code>。</p><ul><li><p>缓存池实现：</p><ul><li>服务初次启动时，通过fs遍历mock文件夹下所有文件，使用require获取export的内容，将其处理后缓存在缓存变量中</li><li>使用文件监听模块，例如<code>globbay</code>等，监听mock文件夹，当发生变化时通过require重新读取变化文件，并更新缓存变量</li></ul></li><li><p>mock数据生成：使用mockjs的node模块</p></li></ul><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol><li>node中import和export报错：<ul><li>查询文档，设置node支持ES6模块</li><li>使用babel-node或ts-node等第三方node启动服务</li></ul></li><li>文件更新后，require变化后的文件，发现内容没有变化：了解一下node的缓存就可以解决，清除node中对于该文件的缓存： <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="built_in">require</span>.cache[<span class="built_in">require</span>.resolve(<span class="string">'./xx.js'</span>)];</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在前端开发转型为前后端分离的今天，敏捷开发越来越重要，前后端分离中敏捷开发最重要的一环就是api mock，前端不需要等待服务端接口开发完成
      
    
    </summary>
    
    
      <category term="nodejs" scheme="https://blog.yanxlg.cn/categories/nodejs/"/>
    
    
  </entry>
  
  <entry>
    <title>IOC</title>
    <link href="https://blog.yanxlg.cn/183e2cbd/"/>
    <id>https://blog.yanxlg.cn/183e2cbd/</id>
    <published>2020-05-16T09:55:42.000Z</published>
    <updated>2020-07-04T03:53:45.285Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>nodejs开发一直以来都是比较麻烦的事，相对于其他服务端语言，如常用的<code>Java</code>，开发过程就显得非常复杂，在其他语言中兴起了大量的注解、注入等思想，而由于nodejs是基于js语法，js中需要手动管理对象实例的创建回收，因而早期nodejs无法实现注解、注入的思想，但是随着<code>Es6装饰器</code>、<code>typescript</code>的兴起，js开发也逐渐变得类服务端化，跟服务端语言一样有具体的类型，接口等，因此在js上实现注解也成为了可能。本文主要介绍IOC的背景、原理、生命周期及简单实现。</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>随着前端的发展，前端开发也已经变成了面向对象编程，而不是早期的面向函数编程。在面向对象设计的软件系统中，它的底层都是由N个对象构成的，各个对象之间通过相互合作，最终实现系统地业务逻辑。而面向对象开发就不可避免涉及到耦合性问题，对象之间耦合度过高的系统，必然会出现牵一发而动全身的情形。耦合关系不仅会出现在对象与对象之间，也会出现在软件系统的各模块之间，以及软件系统和硬件系统之间。如何降低系统之间、模块之间和对象之间的耦合度，是软件工程永远追求的目标之一。为了解决对象之间的耦合度过高的问题，软件专家Michael Mattson 1996年提出了IOC理论，用来实现对象之间的“解耦”，目前这个理论已经被成功地应用到实践当中。</p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>IOC是<code>Inversion of Control</code>的缩写，有些翻译过来叫<code>控制反转</code>，也有些叫<code>依赖注入（DI）</code>。</p><h3 id="控制反转"><a href="#控制反转" class="headerlink" title="控制反转"></a>控制反转</h3><p>&emsp;&emsp;IOC理论提出的主要观点是：借助<code>第三方</code>实现具有依赖关系的对象之间解耦，控制反转的意思是，在你需要生成对象的时候不用来调用我的构造函数new一个对象，而是我自己会在你需要的时候主动new一个对象传给你，简单说就是创建对象时主从关系反转，而控制反转主要由第三方<code>IOC容器</code>实现，系统中所需要的对象都交给第三方去控制，由<code>IOC容器</code>来控制对象的创建和复用从而做到对系统进行解耦。我们再来看看，控制反转(IOC)到底为什么要起这么个名字？我们来对比一下：<br>&emsp;&emsp;软件系统在没有引入IOC容器之前，如果对象A依赖于对象B，那么对象A在初始化或者运行到某一点的时候，自己必须主动去创建对象B或者使用已经创建的对象B。无论是创建还是使用对象B，控制权都在自己手上。<br>&emsp;&emsp;软件系统在引入IOC容器之后，这种情形就完全改变了，由于IOC容器的加入，对象A与对象B之间失去了直接联系，所以，当对象A运行到需要对象B的时候，IOC容器会主动创建一个对象B注入到对象A需要的地方。<br>&emsp;&emsp;通过前后的对比，我们不难看出来：对象A获得依赖对象B的过程,由主动行为变为了被动行为，控制权颠倒过来了，这就是“控制反转”这个名称的由来。</p><h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>&emsp;&emsp;从上面可以知道IOC其实就是获得依赖对象的过程被反转了。控制被反转之后，获得依赖对象的过程由自身管理变为了由IOC容器主动注入。于是，<code>依赖注入（Dependency Injection）</code>这个名词也应运而生。实际上这个名词说出了实现IOC的方法：<code>注入</code>。所谓依赖注入，就是由IOC容器在运行期间，动态地将某种依赖关系注入到对象之中。<br>所以，依赖注入(DI)和控制反转(IOC)是从不同的角度的描述的同一件事情，就是指通过引入IOC容器，利用依赖关系注入的方式，实现对象之间的解耦。</p><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>统一管理对象生成，在相同生命周期中进行复用，较少创建多实例开销，较少内存消耗。</li><li>代码结构简单，各模块之间解耦，便于理解和维护。</li><li>开发方便，开发效率提升，使用IOC后不需要太多关注不同对象之间的依赖，不需要去写创建对象的方法。</li><li>为广泛使用的接口更改实现类比较简单（例如，用生产实例替换模拟web服务）</li><li>实现拦截器、守卫等功能更加简单</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>软件系统中由于引入了第三方IOC容器，生成对象的步骤变得有些复杂，本来是两者之间的事情，又凭空多出一道手续，所以，我们在刚开始使用IOC框架的时候，会感觉系统变得不太直观。所以，引入了一个全新的框架，就会增加团队成员学习和认识的培训成本，并且在以后的运行维护中，还得让新加入者具备同样的知识体系。</li><li>由于IOC容器生成对象<code>基本</code>都是通过反射方式，在运行效率上有一定的损耗。如果你要追求运行效率的话，就必须对此进行权衡。</li><li>IOC框架产品本身的成熟度需要进行评估，如果引入一个不成熟的IOC框架产品，那么会影响到整个项目，所以这也是一个隐性的风险。</li><li>额外的配置，使用<code>IOC</code>框架产品，必然需要进行大量的配制工作，比较繁琐，对于一些小的项目而言，客观上也可能加大一些工作成本。</li></ol><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>&emsp;&emsp;<code>IOC</code>中主要用到的技术是反射，在<code>.Net</code>、<code>Java</code>、<code>PHP5</code>中反射比较常见，用的也比较多，而在js和nodejs中反射并不常见，对于js而言，反射是新增的api，很多环境下不支持，而对于nodejs而言，反射用处并不大，目前因<code>IOC</code>的兴起而逐渐被广泛使用。Nodejs中最初实现<code>IOC</code>并发展的比较好的，首先就数<code>Nest</code>框架。<code>Nest</code>基于<code>Express</code>做了上层封装，整个框架采用了大量注入，目前使用量比较广泛，用户数也已经超过alibaba的<code>egg</code>，但目前alibaba也在基于<code>egg</code>做<code>IOC</code>上层封装，新的框架叫<code>midway</code>，只不过目前还不成熟。<code>Nest</code>是基于<code>Express</code>进行封装，而<code>midway</code>是基于<code>koa2</code>进行封装，在并发性能上<code>koa2</code>要超过<code>express</code>不少。当然<code>Nest</code>也能无缝从<code>Express</code>切换到<code>Fastify</code>(一个号称并发行最好的Nodejs服务中间件)，但其并没有大量流行使用，与已经发布的<code>koa3</code>相比结果也不明确，因此目前很多人还是比较看好<code>egg</code>及上层框架<code>midway</code>。<br>&emsp;&emsp;生成对象使用的是反射，而注入的实现，我们就需要知道目标对象的<code>元数据</code>，通过<code>元数据</code>我们才能从<code>IOC容器</code>中获取或者创建目标对象。<code>元数据</code>相对于前端来说比较抽象，因为js是弱语言，没有类型之分，而且也不支持<code>元数据</code>的修改和获取。随着<code>typescript</code>的广泛运用，前端工程是在Nodejs中实现<code>IOC</code>有了希望，通过<code>ES6 Decorator</code>技术以及<code>typescript</code>中的类型定义及编译后生成类型元数据再加上第三方库<code>reflect-metadata</code>终于凑齐了实现<code>IOC</code>的必要条件，因此，Nodejs中<code>IOC</code>也逐渐流行开来。</p><blockquote><p><code>元数据</code>（Metadata）：为描述数据的数据，对数据及信息资源的描述性信息。元数据（Metadata）是描述其它数据的数据（data about other data），或者说是用于提供某种资源的有关信息的结构数据（structured data）。元数据是描述信息资源或数据等对象的数据，其使用目的在于：识别资源；评价资源；追踪资源在使用过程中的变化；实现简单高效地管理大量网络化数据；实现信息资源的有效发现、查找、一体化组织和对使用资源的有效管理。 元数据的基本特点主要有。例如<code>红苹果是一种红色的，圆的，吃起来可口的水果</code>，其中涉及到这样几个信息：颜色（红色）、形状（圆的）、口感（可口），有了这些信息，我们就可以大致想像出红苹果是个什么样的水果。推而广之，只要提供这几类的信息，我们也可以推测出其水果的样子。</p></blockquote><p>主要技术：</p><ul><li>Decorator</li><li>reflect-metadata</li></ul><p>实现步骤：</p><ol><li>需要支持注入的类通过<code>Decorator</code>添加特定的元数据，以便能被scanner扫描到</li><li>在使用的类中通过属性装饰器，将需要注入的对象类的元数据添加到该类的元数据上，以便于在创建该类的实体时scanner可以扫描到内部需要注入的对象信息从而进行对象注入</li><li>定义scanner，服务启动阶段扫描文件，处理元数据，执行阶段分析元数据创建依赖对象，管理<code>IOC</code>容器等</li></ol><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p><code>IOC</code>的对象生命周期或者<code>Scope</code>通常分为三种，分别为<code>Request</code>、<code>Transient</code>、<code>SignleTon</code>，不同的框架中可能叫法不一样，但最终的生命周期都是一样的。</p><ul><li><code>Request</code>：<br>顾名思义就是，生命周期就是与<code>请求链路</code>关联，请求建立开始，该实例创建，请求链路结束，该实例销毁，自动回收。当然并不意味着一定在请求建立时就立即创建对象，有可能是在请求链路过程中才开始创建，该Scope仅表示该类实例在整个请求链路中仅会实例化一次，后续都是复用之前创建的实例，在请求链路结束后立即销毁，释放内存。</li><li><code>Transient</code>：<br>顾名思义，生命周期比较短，仅能作用与当前类或提供者，意味着每个类或提供者中都要创建新的实例，不能跨类复用，等待自动回收，与请求链路没有关系，程序启动时实例化。</li><li><code>SignleTon</code>：<br>顾名思义，全局唯一，在整个进程中公用一个实例，该实例在服务启动阶段就会被<code>scanner</code>创建出来，即与<code>Application</code>生命周期关联。</li><li>生命周期覆盖：一个<code>Scope</code>的类中注入了另一个<code>Scope</code>的类实例就会发生生命周期覆盖，按照<code>Scope</code>的优先级的一定规则（<code>Request</code>&gt;<code>Transient</code>&gt;<code>SignleTon</code>）进行覆盖，例如：<ol><li>一个提供器类中注入了一个<code>Scope</code>为<code>Request</code>实例，那么这个提供器会强制提升为<code>Request``Scope</code>，不管之前设置的是什么，这很好理解，属性需要在request链路中才能创建那么提前创建也没有意义</li><li>父<code>Request</code>、子<code>Transient</code>或<code>SignleTon</code>则互不影响，子仍然提前创建，父在请求链路中创建并注入已经创建好的子实例</li><li>父<code>Transient</code>、子<code>SignleTon</code>或者父<code>SignleTon</code>、子<code>Transient</code>，这两个互补影响，都是Application运行时创建，主要区别就是<code>Transient</code>有个局部作用与就是单个类的实例中复用</li></ol></li></ul><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.ts</span></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;scope:Scope.Request&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Utils &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"utils 类实例化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> test()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"我是 utils 的 test方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// userService.ts</span></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;scope:Scope.Request&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserService &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"UserService 创建实例"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Inject</span>()</span><br><span class="line">    <span class="keyword">private</span> utils: Utils;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> getUserIdBySession()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"called is UserService.getUserIdBySession"</span>)</span><br><span class="line">        <span class="keyword">this</span>.utils.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// userController</span></span><br><span class="line"><span class="meta">@Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> UserController &#123;</span><br><span class="line">    <span class="meta">@Inject</span>()</span><br><span class="line">    <span class="keyword">private</span> utils: Utils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span>()</span><br><span class="line">    <span class="keyword">private</span> userService: UserService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">async</span> getUserInfo() &#123;</span><br><span class="line">        <span class="keyword">const</span> userId = <span class="keyword">this</span>.userService.getUserIdBySession();</span><br><span class="line">        <span class="keyword">this</span>.utils.test();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'success'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述代码中，<code>Utils</code>类在被<code>scanner</code>扫描到后会立即创建一个该类的唯一实例，跟当前进程关联，<code>UserService</code>类由于<code>Scope</code>是<code>Request</code>，因此在请求被建立并用到该类对象时才会被创建，也就是在<code>UserController</code>被实例化时一起被创建且被注入到<code>UserController</code>实例中，而<code>UserController</code>和<code>UserService</code>中的<code>Utils</code>都是直接被注入启动时已经创建好的实例，当然，这仅仅是<code>IOC</code>中常规的使用方式，还有其他的例如构造函数注入，方法参数注入等等，基本原理都是一样的。</p><h2 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h2><p>上面介绍了<code>IOC</code>原理，和简单使用，下面为了更加了解<code>IOC</code>，我们通过简单的代码实现一套<code>IOC</code>框架。</p><ol><li><p><code>reflect-metadata</code> 第三方库引用<br><code>reflect-metadata</code>第三方库是用于扩展js中<code>元数据</code>的设置和获取，js和nodejs中目前没有<code>元数据</code>相关的api，因此需要使用其他方式进行扩展，<code>reflect-metadata</code>本质上是使用<code>WeakMap</code>作为<code>元数据</code>容器，将类的<code>元数据</code>存储在容器中，并不是直接修改了类的描述<code>元数据</code>。</p></li><li><p>注入装饰器实现</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Injectable.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> Scope &#123;</span><br><span class="line">    Request,</span><br><span class="line">    Transient,</span><br><span class="line">    SignleTon</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> InjectableOptions &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Specifies the lifetime of an injected Provider or Controller.</span><br><span class="line">     */</span></span><br><span class="line">    scope?: Scope;<span class="comment">// Scope 类型见上文生命周期</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SCOPE_OPTIONS_METADATA=<span class="string">"scope_option_metadata"</span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 用于装饰支持注入的类，表示允许通过注入方式创建对象，添加该元数据方便scanner扫描并分析哪些类需要进行注入管理</span><br><span class="line">**/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Injectable</span>(<span class="params">options?: InjectableOptions</span>): <span class="title">ClassDecorator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">target: object</span>) =&gt;</span> &#123;</span><br><span class="line">        Reflect.defineMetadata(SCOPE_OPTIONS_METADATA, options, target);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Inject.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PROPERTY_DEPS_METADATA = <span class="string">'property_deps_metadata'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SELF_DECLARED_DEPS_METADATA = <span class="string">'self_declared_deps_metadata'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isFunction = <span class="function">(<span class="params">fun:<span class="built_in">any</span></span>)=&gt;</span><span class="keyword">typeof</span> fun === <span class="string">'function'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 用于装饰被注入属性，主要是将一个类的依赖注入数据都添加到该类的构造函数上，当Scanner创建该类时就可以直接读取依赖元数据进而创建并注入需要的依赖对象</span><br><span class="line">**/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Inject</span>&lt;<span class="title">T</span> = <span class="title">any</span>&gt;(<span class="params">token?: T</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">target: object, key: <span class="built_in">string</span> | symbol, index?: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        token = token || Reflect.getMetadata(<span class="string">'design:type'</span>, target, key);<span class="comment">// 获取typescript定义的类型装饰器，‘design:type’是typescript为属性类型专门创建的一个metadata</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">type</span> =</span><br><span class="line">            token &amp;&amp; isFunction(token) ? <span class="function">(<span class="params">(<span class="params">token <span class="keyword">as</span> <span class="built_in">any</span></span>) <span class="keyword">as</span> (<span class="params"></span>) =&gt; <span class="built_in">void</span></span>).<span class="params">name</span> : <span class="params">token</span>;</span><br><span class="line"></span><br><span class="line">        <span class="params">if</span> (<span class="params">index !== <span class="built_in">void</span> 0</span>) &#123;</span><br><span class="line">            <span class="params">let</span> <span class="params">dependencies</span> =</span><br><span class="line">                <span class="params">Reflect</span>.<span class="params">getMetadata</span>(<span class="params">SELF_DECLARED_DEPS_METADATA, target</span>) || [];</span><br><span class="line"></span><br><span class="line">            <span class="params">dependencies</span> = [...<span class="params">dependencies</span>, &#123; <span class="params">index</span>, <span class="params">param</span>: <span class="params">type</span> &#125;];</span><br><span class="line">            <span class="params">Reflect</span>.<span class="params">defineMetadata</span>(<span class="params">SELF_DECLARED_DEPS_METADATA, dependencies, target</span>);</span><br><span class="line">            <span class="params">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="params">let</span> <span class="params">properties</span> =</span><br><span class="line">            <span class="params">Reflect</span>.<span class="params">getMetadata</span>(<span class="params">PROPERTY_DEPS_METADATA, target.constructor</span>) || [];</span><br><span class="line"></span><br><span class="line">        <span class="params">properties</span> = [...<span class="params">properties</span>, &#123; <span class="params">key</span>, <span class="params">type</span> &#125;];</span><br><span class="line">        <span class="params">Reflect</span>.<span class="params">defineMetadata</span>(<span class="params"></span><br><span class="line">            PROPERTY_DEPS_METADATA,</span><br><span class="line">            properties,</span><br><span class="line">            target.constructor,</span><br><span class="line">        </span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>实例容器<br>根据上述<code>Scope</code>分类，可以直接将容器分为三个，部分框架直接使用一个容器来管理，对于注入的类创建一个单独的子实例池来控制。下面主要介绍单个容器的方式，其实容器的多少实现方式大同小异，仅注入实例时从哪个容器中取和添加需要不同的逻辑判断而已。简单的设计图如下：</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/183e2cbd/container.png" class="" title="IOC容器"><p>核心代码实现：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IOC 容器</span></span><br><span class="line"><span class="keyword">import</span> &#123;PROPERTY_DEPS_METADATA&#125; <span class="keyword">from</span> <span class="string">"./Inject"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> InstancePerContext&lt;T&gt; &#123;</span><br><span class="line">    instance: T;</span><br><span class="line">    isResolved?: <span class="built_in">boolean</span>;</span><br><span class="line">    isPending?: <span class="built_in">boolean</span>;</span><br><span class="line">    donePromise?: <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> InstanceWrapper&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> name:<span class="built_in">string</span>,<span class="keyword">public</span> metatype:Type&lt;<span class="built_in">any</span>&gt;,<span class="keyword">public</span> metadatas:<span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> values = <span class="keyword">new</span> WeakMap&lt;<span class="built_in">any</span>, InstancePerContext&lt;unknown&gt;&gt;();<span class="comment">// 实例池容器</span></span><br><span class="line">    <span class="keyword">public</span> loadInstanceByContextId(contextId:<span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.values.get(contextId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> addInstance(contextId:<span class="built_in">any</span>,instance:<span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="comment">// 简单设置</span></span><br><span class="line">        <span class="keyword">this</span>.values.set(contextId,&#123;</span><br><span class="line">            instance:instance,</span><br><span class="line">            isResolved:<span class="literal">true</span>,</span><br><span class="line">            isPending:<span class="literal">false</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> getInstance(contextId:<span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取实例，如果不存在则创建</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.values.has(contextId))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.values.get(contextId);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> instance = Reflect.construct(<span class="keyword">this</span>.metatype, []);</span><br><span class="line">            <span class="keyword">this</span>.values.set(contextId,instance);</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Type&lt;T&gt; = <span class="keyword">new</span> (...args: <span class="built_in">any</span>[]) =&gt; T;<span class="comment">// 类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> IOCContainer&#123;</span><br><span class="line">    <span class="keyword">private</span> _injectables = <span class="keyword">new</span> Map&lt;<span class="built_in">any</span>, InstanceWrapper&gt;();<span class="comment">// 实例池容器</span></span><br><span class="line">    <span class="keyword">private</span> _controllers = <span class="keyword">new</span> Map&lt;<span class="built_in">any</span>, InstanceWrapper&gt;();<span class="comment">// 实例池容器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> addController(metadataType:Type&lt;<span class="built_in">any</span>&gt;)&#123;</span><br><span class="line">        <span class="keyword">const</span> metadatas = Reflect.getMetadata(PROPERTY_DEPS_METADATA, metadataType);<span class="comment">// 获取依赖 deps</span></span><br><span class="line">        <span class="keyword">this</span>._controllers.set(metadataType.name,<span class="keyword">new</span> InstanceWrapper(metadataType.name,metadataType,metadatas));<span class="comment">// 创建该类的实例</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> addInjector(metadataType:Type&lt;<span class="built_in">any</span>&gt;)&#123;<span class="comment">// 添加IOC容器管理类，通常scanner调用</span></span><br><span class="line">        <span class="keyword">const</span> metadatas = Reflect.getMetadata(PROPERTY_DEPS_METADATA, metadataType);<span class="comment">// 获取依赖 deps</span></span><br><span class="line">        <span class="keyword">this</span>._injectables.set(metadataType.name,<span class="keyword">new</span> InstanceWrapper(metadataType.name,metadataType,metadatas));<span class="comment">// 创建该类的实例</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> getInjectable(<span class="keyword">type</span>:<span class="built_in">string</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._injectables.get(<span class="keyword">type</span>);<span class="comment">// 获取实例池</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> getController(metadataType:Type&lt;<span class="built_in">any</span>&gt;)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._controllers.get(metadataType.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>扫描器</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UserController <span class="keyword">from</span> <span class="string">"./demo/Controller"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;UserService&#125; <span class="keyword">from</span> <span class="string">"./demo/Service"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Utils&#125; <span class="keyword">from</span> <span class="string">"./demo/utils"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;IOCContainer, Type&#125; <span class="keyword">from</span> <span class="string">"./IOCContainer"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;PROPERTY_DEPS_METADATA&#125; <span class="keyword">from</span> <span class="string">"./Inject"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;SCOPE_OPTIONS_METADATA&#125; <span class="keyword">from</span> <span class="string">"./Injectable"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;CONTROLLER_TYPE&#125; <span class="keyword">from</span> <span class="string">"./Controller"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Scanner &#123;</span><br><span class="line">    <span class="keyword">private</span> iocContainer = <span class="keyword">new</span> IOCContainer();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 扫描项目中所有类，此处demo写死</span></span><br><span class="line">        <span class="keyword">const</span> classes = [UserController, UserService, Utils];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化容器</span></span><br><span class="line">        classes.forEach(<span class="function">(<span class="params">classType</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> isInjectable = Reflect.hasOwnMetadata(SCOPE_OPTIONS_METADATA, classType);<span class="comment">// 获取提供者</span></span><br><span class="line">            <span class="keyword">const</span> isController = Reflect.hasOwnMetadata(CONTROLLER_TYPE,classType);</span><br><span class="line">            <span class="keyword">if</span> (isInjectable) &#123;</span><br><span class="line">                <span class="keyword">this</span>.iocContainer.addInjector(classType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(isController) &#123;</span><br><span class="line">                <span class="keyword">this</span>.iocContainer.addController(classType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> loadDeeps(contextId: <span class="built_in">Object</span>,metadatas:<span class="built_in">Array</span>&lt;&#123;key:<span class="built_in">string</span>;<span class="keyword">type</span>:<span class="built_in">string</span>&#125;&gt;,callback:(instances:<span class="built_in">Array</span>&lt;&#123;</span><br><span class="line">        key: <span class="built_in">string</span>;</span><br><span class="line">        instance: <span class="built_in">any</span>;</span><br><span class="line">    &#125;&gt;)=&gt;<span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> instances = metadatas.map(<span class="function">(<span class="params">metadata</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> instanceWrapper = <span class="keyword">this</span>.iocContainer.getInjectable(metadata.type);</span><br><span class="line">            <span class="keyword">const</span> instance = instanceWrapper.getInstance(contextId);</span><br><span class="line">            <span class="keyword">if</span>(instanceWrapper.metadatas &amp;&amp; instanceWrapper.metadatas.length)&#123;</span><br><span class="line">                <span class="keyword">const</span> _callback = (instances: <span class="built_in">Array</span>&lt;&#123;</span><br><span class="line">                    key: <span class="built_in">string</span>;</span><br><span class="line">                    instance: <span class="built_in">any</span>;</span><br><span class="line">                &#125;&gt;) =&gt; &#123;</span><br><span class="line">                    instances.forEach(<span class="function">(<span class="params">&#123;key, instance:ins&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                        Reflect.set(instance, key, ins);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        key:metadata.key,</span><br><span class="line">                        instance</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.loadDeeps(contextId,instanceWrapper.metadatas,_callback);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                key:metadata.key,</span><br><span class="line">                instance</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> callback(instances);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> loadController(contextId: <span class="built_in">Object</span>, controllerClass: Type&lt;<span class="built_in">any</span>&gt;) &#123;<span class="comment">// controller</span></span><br><span class="line">        <span class="keyword">const</span> instanceWrapper = <span class="keyword">this</span>.iocContainer.getController(controllerClass);</span><br><span class="line">        <span class="keyword">const</span> instance = instanceWrapper.getInstance(contextId);</span><br><span class="line">        <span class="keyword">if</span>(instanceWrapper.metadatas &amp;&amp; instanceWrapper.metadatas.length)&#123;</span><br><span class="line">            <span class="keyword">const</span> _callback = (instances: <span class="built_in">Array</span>&lt;&#123;</span><br><span class="line">                key: <span class="built_in">string</span>;</span><br><span class="line">                instance: <span class="built_in">any</span>;</span><br><span class="line">            &#125;&gt;) =&gt; &#123;</span><br><span class="line">                instances.forEach(<span class="function">(<span class="params">&#123;key, instance:ins&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                    Reflect.set(instance, key, ins);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.loadDeeps(contextId,instanceWrapper.metadatas,_callback);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> receiveRequest(request:<span class="built_in">Object</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.loadController(request, UserController);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Scanner;</span><br></pre></td></tr></table></figure><p>简化核心代码就如上，在基础上扩展异步构造方法的支持<code>isPending</code>属性控制等逻辑就可以形成完整的IOC框架，具体的可以参考<a href="https://github.com/nestjs/nest" target="_blank" rel="noopener">Nest.js源码</a>，或者参考我个人造的轮子<a href="https://github.com/yanxlg/sky" target="_blank" rel="noopener"><code>flybirds</code></a></p></li></ol><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>本文主要讲解<code>IOC</code>实现原理以及简单的代码，不贴大量源码，真实<code>IOC</code>框架需要考虑更多东西，例如构造函数入参注入，方法参数注入，异步注入等等</p><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ol><li>回收机制：前端<code>IOC</code>中回收机制使用的是<code>WeakMap</code>进行管理，通过释放key的因哟过达到释放实例的目的。前端中<code>WeakMap</code>兼容行不好，因此前端目前没有类似<code>IOC</code>框架，一是因为影响前端性能，而是引入库较多，最终影响都是性能问题。而在Nodejs中已经支持了<code>WeakMap</code>，与客户端环境无关。</li><li>前端某些框架中<code>@Inject</code>装饰器，例如<code>Mobx</code>，是属于<code>IOC</code>废弃设计<code>DL</code>开发的，属于依赖查找，并不是真实意义上依赖注入，仅仅是通过装饰器修改类，在原有组件类上Wrap了一层函数式组件，组件中查找需要的Mobx实例，作为props传递给真实类组件，而且Mobx中实例都是业务代码中主动创建并添加进去的，并不是第三方通过scanner扫描后创建的，<code>IOC</code>分为<code>DL（依赖查找）</code>和<code>DI（依赖注入）</code>两种，不过<code>DL</code>也已经废弃。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;nodejs开发一直以来都是比较麻烦的事，相对于其他服务端语言，如常用的&lt;code&gt;Java&lt;/code&gt;，开发过程就显得非常复杂，在其他语
      
    
    </summary>
    
    
      <category term="nodejs" scheme="https://blog.yanxlg.cn/categories/nodejs/"/>
    
    
  </entry>
  
  <entry>
    <title>git</title>
    <link href="https://blog.yanxlg.cn/518e617c/"/>
    <id>https://blog.yanxlg.cn/518e617c/</id>
    <published>2020-03-17T01:48:45.000Z</published>
    <updated>2020-05-10T10:01:16.306Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="ee3ec5ad384bcdcace85f4b7182cd92c843ac1cf4b239eff71f5006aff199ee7">ee7bd50d85d8f21323fb4fe72f97eaf2d7101ad2aade0725b1fef157726611e90445df1f6e26faa96e2fd7e3f7bb1cfdc9b6718b563c5130ac48ba2652bfd6f0c2efb1962946e9b8039ce663ba8ed1563b9e71fdb9c785921b55dd360d31194a06d30289b03ed0a4c65edf003c54d2ef2fc1d8ec3f6f7d00c0bded5a18ced3f9534164eafd6abc8ca25fd70720c9a3fe28d638dcb92c371357e9f8c90a89282c1a5f86b2e6f618ca7e0a5fc9e3bcdc7990272d2ff94e6dc11a31a4bba15c1a5de7119dde304649c33fb356c1bea4125326286f9a8633d2e00f5a3f9cca961c2dd8620e6feddb327dc6fa840e5c1f7856820a10c41b1a3c02c3c164d80885d23e1bf003058923a19ca6fdae4d63418119aceb5c72907c1a2ed5a972309553c401a07361d168062c982a33cf93f0619cd349a08b0d51ec470d0acb8218b57876731ddb1dbc35b613c3392bd981982844216f225ea7919ef9498214c3cdaa3c9b4cf816e308a8a87114c992ca8ebb0b8f5df977d83d3835ac71ece5491ef881db5f9d9e564b6420cd26979ef4202f0d9651b6242af9f5d8d75d099efc865b67674f72f0916b1b6176c61179332c759593cf33302f98f3197d9742e593404a386bd6e496aab43c3ca41fa17f11beb0b17bda59233ae49f027b82658ed75ac58bff79a81c5c394ba3779d1d53a517ed654ce73b1e256eb68bf892d6381533f23b2bf0896db67dc8d1f8cb0088a5176e4638e85ce30fe19be91af436135929f66870c13eb966181951b63b7669515af1a267d3905995a575731bc2c4c660c9e2aa4eaa8814842fa3b2284c13d6fbdee33b67a041b880a221c95a114effcc7bdbcd6522b442c96eea790d840946d0ce581ea2f774022550e82a73b80b30decc4cf730530ea37b42797045a068036646186ebae6aa738b8c1fdf00acfa810a93cafa5ae1279c76524f750a7080c8d9825f6bf5f2b3161cbc913932d8cc6ae182058ff5550ecb485f4d888ccae892b41d7ca3f6b9c32c74cfa21801967688ea80f504f5c502391e384e1f908a6f3a75555bb324139f1b49355ff105cc9491f3f0fe13f99b672b92ce8e2296b98306a501c70f80f736fdb4f6a3558d0442f01b20462e612fb183020848f2a9dd9dd019a6a903f68187065e916165328d8d409bf0da3b4772bc6493e868ef67cdd70a433c75256b8275f3a16950a0f32a018bf3cc6ae1203a3680e581910b24740e802442e11e94432be60f1e4faa91b38106b675925f5e3b5f42bae76135de1fbf4fd70a69b81dd5f7b53893a3d0279b495d39a22445a3d5139c1d733b47ec8b01232a64df80b10eedbd2dfb7de284992624b9ead22bfa6e03860444a861ed6f688afca97cd2f8dbe199f72c8544334f92f562fce232992793a46f14f6dee24f0418f14eb2a026f4297e8a98abfc87630a5cf7460462168d0a22d1dfc60f97313a7afdb50b804a33d481c023c06fe83836f1db10520149aac4bbd5c044035f081ba2f49b22cfd382d429e33f7bd6615d78265ff23e4a00645340f8133e229b02dae6a59d23b978953a4b5d6c9e055c81668f5a5c4526d438acc4439662c936f4dce61940a4f91144510be7d6037609682b53b29dcb6621b40196c4112d806d8dc277c0fca6636b8036c40ab836968b04b756f056b3ebdca020ebf95d7d207bf5d2787a12a0abb836</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
      <category term="git" scheme="https://blog.yanxlg.cn/tags/git/"/>
    
      <category term="tools" scheme="https://blog.yanxlg.cn/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>rn-base</title>
    <link href="https://blog.yanxlg.cn/140ab620/"/>
    <id>https://blog.yanxlg.cn/140ab620/</id>
    <published>2020-02-27T02:05:22.000Z</published>
    <updated>2020-05-10T10:00:22.618Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="deb44d823330854d972da65ad95a355a42de551de12cfdc7f4d51937fe0f26dc">76a7c2d69f910a96efe6d4a85086bd083b71be6382a756a0ea08c2f18f8205b2dc5f7b340d04aefbcab27741555ea0fefdf4afea40a8d8f3349545a73a10a806f501c971e515c7af4c7987e626c74cdc35fe0ab867611cb72217c33fa67622d6c7c9814ae1142e3a01778096c299f6fcafa1336cc087055a3d94c1e2166a45ab4a3c67b412a2c1037f3e982a8e1978b47652f9bf416873eee8f172524e184cc1b14b03686683673f3f96647bcd68ae30d11bbbc065de7de09bfff81684df267063df8632f8d9009ebd7afcb7629227cc33156f049fee94d10cb6afb452ad8b4e0360e0640b5116e57cceffd33566ac5ccb1f91500f278c6c0f4824331a4973f1d3bb97ea0b16e4b3347d270b8f1f877a2389d1d08241394dc343b035cb42988a8895fce24c2d359955584159cdd128ea4f3f8b5160d6d0c6e80a0507584daa05d320dbf29f1c6dda0fc73c047c52783cfca3c0bccb3d0e2d3b14badd6a49b9b21a4f1e252e7f117bd8ac461ee3cd634b38982bd644f794af05f579ac00929ccfdaf0b2cf854b9d8dc71fc5b4f659e1222b6f66acd264126b2c5ef3d121f3f01296c1746bf01ed8e94d96a4e5b9d05428df687a314ff43e05ba30b9f083b275e08dc7ea7812113eab94535a1b8e151c4383ff7e3c9d46dbaf25f362ef87d0f6d006231847477246034b39cb58e23cb85bd5f95174b106785d9056281f2c0af872fddee0b4d17554813931781b8ba98d33c25f608b5ab8208d1da8e1a95d18003d85669b424e51f4e5cf4f76a3005515be853679d2a9e3e2828c0d2f79a07bff5f861bec37a0331cc237cf3b0c302c0fccb2b433f9dd42f4d27817d55c4886eac0e9712675c577056a3605106f9adf5e76b33ec7fba71b661b0f81f16f6cd455b88e79644fd790f1fd92d0054f77ccf26fff3139e81aa4329e1b7a8a5959155aced8dbf50d746f82a07d8012ca4f751382270277ebf153aa73ced6e4442b905265a843ef87c57baf43f590a20cdf5fb7fe77f0da85cbb629b2897fb8deee7d8c4013ddbb74217c6530f74d8395a159a032dfc26cb059abf9bc098297eb0ceeae1de80d4fc860e58062d596a0e1dc96ced0d1a41fe4d2718904341746723916a37ab8decb4d0625dfe91d8e9acbfe5e2bcc4ab78a9d881b347c95e29c9906a733975a2bc65762aec50a1a6b109d9b54c302ef0aef54636a422340fea726cc0f0feaa32169e28a445843d0aa11b7a9a89d6fd894b49ccaba2f3c344dfd001f275813a96a332268dcb02dda5a477b7806784209399ca6814c017f344323404b1f80c6a3ea9a1bc0d26267ef2e6d83979423ce8398f9717d85fa7a91c97e171f43ac08b4b9b898afa5e29fdadde3e45ecf8ab7ef2ac24c81969c073063d4b078c2791e0bd24458f5ea40b3b3fe68dbc1c9467c6a8b0a330e22e485ab75b40ce4020f9bf9feb6af4e163d9e4d237b033ef257131e1476703b0a65dfd6684958bbe296d72779e22ad8fbefad56e967b8dfcd4d667cb425ee6eee211af6ea82b29ccd7b64343453bdb71398cad31960ca61be315772fbccb69d6690f20b6572af817730af60e12006ff891cc4756f3ca03ab871524508955f26218bb7ab1be9b30b1862f710d90475095d7aab125e6b9ace304af6166999ced15a83e2be8be13240f97b0e606d56b48a5c441dd64414156b93d4f4601f8cf49bb3e10388f1f5c3ea041cdef9fc2d64d20e986fab89220ceabf3ccb6b1c7f03f9512b887c88266e325f28db3259ad9207be7a65ad2e77bea0c7bd2c5f42f96cab18090977b25be1ff7576bd5b6a0166334200ae1a65eecc9a400f3933952a8af2ea96512a59223b35359422f1f92730d78086e1cfc794ee2d97e2c6aac94c65f6661c78670fb1d815b6e1d8da18001c5399e015655e25486477d46bee81f8b957a6d51ce5964baa749edd3cff7288f7a134d01b46084ea87fe9c4447044bf8444ad92b0aff0e53780b81c0a9ae7949728bb66c446f3cfb767af62cb871f978bd6ff03437bef0e54156ccaf126b2de5a4717be70e310e4c15dbe574c103e1f1db25c95ee7d7fd80b5c80d9a20b8f1aa51089595d1983cc01ce8324542c0b35a072e6194c12ae68c0082ee441a465a997a12769d2decbc3149465d176ecd86701ade76b30b7ed3bfa3e99cb8eaf948ddc658bae9fbfbb235c15b102ff396fcb881ee8d8941039ecdeb165b0d06609c6850d3ea93f1eebec6d756c843ac83a15d3df553ad55d170330f454ba0318aa59fd0fb18400173d0fd3d14ba0a3e4567220b04da727ba464cab381f4ca01d50cea37924bbc821b846a20d31e328db5f1d2f92c6d180b81307a600c4a4dc0223973c1fb03c7f0f646fc96701c462c78a6098d361258e55274227c8eef8fd7b4c131dd40d459a0bcd9e427bfb1df0d9ef7dd54a7d9fc6892b1134ec84b7ed5c147f26a5029a8ca37a4e77bcb1372c6cfc7bfd39578ab7584dd6cedb76061333329b3fe727b0967f889fa3b9c3108fb3e9bd9b2365aa85eaf93681afdb4a137eb8ef47e350969a42df52aad90b4acd0ade20e2fe4d7cc119bb558a2a096c1db8e01dae59fc4de4b5229d2d6e53574e845676cd9d4ddce71dbe65956a4c093674d2525f4b1954480e344a2d32d56ef502cd59f77369b65f1b955dd1f4c9fcdd9a46edfa4af4967c4290b474ec3f1a48ea87f76d9c33000ed573ec2e14277c9e129377ef7d665d522d6606c5dfe58c719ba8428996f9b0c7625130705a5515c2865d1e010dbbcd77d76cf8b7f2d64f9021c2afea13c9aa0248705be9c94e05e397c248d3e6c2b9b721a6e5949026bac80c339139d93c633935b8d333e2ab1337b7f69db6f27b8fac63b2b699afacf2ccb7a265114a724b6d547e01c61d0664c626c217df439f5ffdaf5d4713b49e765347d76ac017b1c5e2c38a630049034704d3f14c0b92bb35cbf2bfb3ed57ed506c73c60af2bbb492d88c521905b78aaa11426be1b3ac9749fb3631aca81a2bf3b3b0082a46f78f7dc2becf79c9dd9cbef426315b2588376dc24dfe9b12c1503bae2323f5f77ed19bc96e36f6744f1bab6979bd6169326d2526860e5bec42a66a89d8ca86ea830f258f999f0593cdb4ce8ec9e8776a2de36c7e5b6e060c339c53be15c7472b0a7e927bbb696c9ccc94894f6fd247a301eda55137044935fa0af1d638801cf3292a1d74c7d34c578fa9ac7fb591b1d92d527b589981bbe040e1baecb3037366f7283aa367a190b81c3389cb1ce6b4ea4bf14d8fd0c5677a329a335e3711803f791213eadfd283d1ccd9e6f735f33ca077c921ffd5e09cc2c3d4443fdcc62f78bbeb07ceb83bce6eeb49b85c0d31d773f404515b53bf3d74bb56d2b494f2d6b34a3e7b650fd4d00ddd71e65283c77bc4e53b40a9ce5af77266bd3a068a266af473d2ebf7863ea096ed1fb2d4bfe6f5c3646d4f8dc48c68a6cb78a42ef33dde95f561ef9cfdb9b30a92dc537f11097542e9f952225ade014015695102cff91d9f6e1eab217f63e6ecc68119b14aa9ed70c331dea3cb956442e7e5bb127fc480bf1d3d45eb0c7d48ef628795bd39975b48563a272a0f70c3e1ca51b6626f2010a54be7978b68aa3ee6b28482b5423d5d4b54dc06d22754a173d2450070dbb5d1482b7719ae7208d1a4b65448fde2ac80e91073d3ada790601105a1fd09a910ed95a0d56cb487a01fc56e1a27cdffb263763edb9de3e8268ebe7f0dd9feedb7af5005532a6968a4034646663f39bb93e5364127292e2a4ea4cabf03dbcc479de4c60127c3c13897678d69b152f59ceef7138baf14b4e8777d6ad38fe9d1e7b32e6a4065a93d45e100cf626d5655de97ff768f2ebc5c0240cb0418ebd0661331792aaa7a906a93eafd77957abedc4b0e5656ea655abb997f3ec1cb419c99c1d81368c547c16f76ca0f608446fd5832f1402813388b3393192c8b85621145019cb2fbb3fe20c44b6e85506a6c8cafd5457e599b5d354b47eeebfe3e0e3c384050d20a253518135dfaf3b8ee5c4c4c4132b80763c9467673b065246bb8c4b13b1eee33b047ea857b2aeeb8688643203a1953b2b6c67970e32155d76f9ebb097843455cf8e014d2713e6182b9467c0ffa2f303920c14bdab8627a55c7a0d6c03919f901108ab5bb28f136805855d8cc464352d43339486da061eb5f2e4c6311e8a630ee9cdafa1a69a14f0a157eb8a36c5d28832c2c345e8175eb2166c2ffcaaee19c18c41b20cbb37b36ff8eec684cb25f70dc0a31724fcd977321f8bca37d624f9b40b67819e50894ca30e916b52f331f59c9b237d9170f8220e529075cd79ffc6cff2d672311be35d62bc896734c0e1e197404ac6115cfe536ded51d2d117c700466dd1c28edb308cabe784f0d5073620dac8a09bebb76b61fc2a5c53bee060d653b3ebda5dc4495d883f500f22fe15505f0efd648c2d92072116ddf49e23ae5e2c8a9b9588d2e16dc9ae82aa7bb2afce09773814109588fc95f5ee537d24f231eb971851afb568723b1f86bea42fadf0ccfdbf2278826785484e0c29b6bc4361d3ee6ad0659d6d911e4ba8d461238e519d4aec9c883147c2b6dee78fe21739ad76742c1baa5bcc48e18c0a32277009e199e55cb62065cba2cb01fc7306fdedd25989c7013c934bcadcb430b52931d01e7b987ba5ecb2ddf58f5e8bf978ddcd1e9dca12da4c10031838ae0e0569d2be96686d7334015a8e288b3dc5afe13039ee911502259501e4fb84f1ad55214d408c084546a3d470a9c6d912f16ebbc37cf20de9d750c68a5b2b05834eb79d35b5cc489ceee3182ccd1dd6cac555fc15988afad2d492ab7d699f7f868819d45077badac032c351df5e0bc23ea49c17418fc5c36159a97e264efa737929d8c47558b964ae1d1d96b6e7f3ca53cbb7e067bce883535315183fbe253c3a30ddac7d17d01d1fce6c9e06db2cf1e319a893a2f8d33498b555521953215b12cb2025b7c1acbdc74b3877068571f343c37ef192a71a3d2141dbd245a044a0c5a5f29cd50767e986c9db80da1b56849d55c79b1f3fbccae92bc497559751b4ea75c6c8b7234c78c716e82813313f7256eea3f39aad7b71c1daacb5448c86c5272528975971ead7e1bf4eb5ccb903c0eb8dce82724b1ca1eb83f5e469e87a3a20898fe03ddedbd6d328a0544002eade083b6d3580570d76ae64f7d9295b24bcb51bbdd5c740bcb3a97c8bd75be52a6057d5ea4dc8a49b367544a396e6021af3943bfcbd83233daa6a3e1367b6f3aa1d26955994487a0e4c51cc5b77b35862629143e43d7a01566a2d0e4d5a5f462c5a62fa7e602b053212ee69484b9819e3f9a1483fe4691d75150398161d1044190421a6d9c4731afe282ee2d43832d8a4d68997af5de7d6a05a96e35134d77f72a37899b8cb87de32a95bfbe621447f8a9e911aa5725c32932593cd242b38b0778a303734e002ac35c1d3f5b1cc74e4ec88edfc2de481ec5f325a89ac82fa233dd84593236062ed4a7fb488feb3876084081e860273d2b52bd868fbda2905662b4dcea4364412504b09edcf1d8fc44ffd1269732877b09b59da57d4f81d661040022d61a06464fcc594b50dad4b64719fc37a4dbd956059aeeeda640cd0497d4210a6ff45a6281a5efa19ab0535234a029a8cbe8ff701ac39cb9044cf946cd6ff1b8bdb99ca2a2bb6586b261a85b98f28a9e91f9dc7d4fcc300a4ec860861842c02857aa93b667b7cd22ebe7cdc3407f4077e216806a4d68d43509a811b7ff77e9c37fd507b0945ed17ad6b354a786e026a4858a7483ab927836f2587daf049aa20c7769957cfca77450c5febd2713a6d1a1ac8fbfa8e64190303acb7622c9b42ea9c2df9f6644c47fde28c97c24544f2cdf8ee87e33d6da0f9f0897aa2d538f7855549054fff5217e7168c9518996d5938eb1ec6c084b3ac5dd5c367aefcc7916b18623103ef798d2c84a98f7b8a045f5749a539d7240c7f9fbe88c12230ac595015512b255cde76fb9b4d8e5a496929ad22d7156876dbb9dfce7d6435b921dc74297cbadb1c9a710647f2d1d4fc2a016764f6b3fe9b4da968302914cab14d2454b0f7834774b321de20b53ec6a3ee1de46fea5818445577280f0af3601912e3d5c0957be0474cfc151a817548649cdb2a11b234f968addb3dc1d00ca2352943c539941236b144b1c0b5f5bd67cb9e0d1f754757212677dcfe89d880f5426acc8ad7f54dcece230e1a205c9be8909298f3351badfd5cd94ca41ce9ff9412bc5055eaa6d77ea880142354c66a9f829cd1a341aadcc6e9be5b2d855e70b10c89b17a26f19568da94f115c45f2f9db9e9986b3f30aa6d63687d6c03ba8d3e94ac1ced14060b27d919d3375aaf5499bdc723b80171d4dd05a9f71073cdb3518c9e843974ad5915db80d633f36a667b63edca34574e3a623caf29debbb2571dde246268429fe1c9ca92a1b284c18035ec59ac6ed5b1757c4c9352ed872ae9e1a408504ce51ab97d8fd2b37eb7c3b091ff37c22dafa3a61d8ee14579e95cb912e7f258019793ef4c8033edd2c3fde714b32d4e991ddbc2ce48b57da7502c5e1f6a43aa19a7df5e2d682acdf8dcd98aadd5ec2985bf4e8e0617d0c31a75b9dd9bfd573a6e3edc1c6e7a7f6bd40dc05064996b26534bccac294e3c886d60648c956bf3fba9763682bf1c3bed4f343c71f70012e2d1b446cc1c9becc102b7b879fa3265ff8e53779e4e58b8fbb32ea2379bfb8d9e3944d7c4db631f5f9c561c5d6d18106d177510721196fa85e436b722cc45144ff2a100b819f8aefcb007ff14c87b8c82e3e44f5237eff8ca63a82b53f2b1355107890ec5b459e7ecb157ad44861021db5e632847a26a8eb4afb48848f87298e6c7f1c52d049cf918b3e246e5f0a68b66980811f27d135674854399e2d792e31b3a5a964df19e129272832725f02390008aa623eec7ec4ec91dbb001e8bca6940e60a8b6492a006761c9cc89b38fb1917bdbb2bac0fe98ba3511f754b1416de95f7b2589bb74b12938fa8bdf2e574fee36ea4bec03ee37eaf9350a3947abc79e41158f9df92c41e4397188ec9f889835475f8e993e1d8a3ba989f640dba3dc5299b499bcb38a</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="随笔" scheme="https://blog.yanxlg.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="https://blog.yanxlg.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>nodejs/index</title>
    <link href="https://blog.yanxlg.cn/92faf83c/"/>
    <id>https://blog.yanxlg.cn/92faf83c/</id>
    <published>2020-02-27T01:44:45.746Z</published>
    <updated>2020-06-01T02:15:53.358Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="582941aa11d2987c8a96d8e693696a97efcbdd4494e964c414679634346d5cc0">e3e818a45afda05df64f43f68f0749daa65269060cfdf9156ca5f5483d166ac49033f0ca49f516b653f0feab260546ec059987f4819909364ea283ae6a8813bc8cda808cb351737e9309fa9a01d46a4e1cd4a4b57c45e03a1e443fadea2ff3b7dc4e3995563d6d501f4b353515b9bb86926ab864e3045477bc9d33a1d7b133cc60c0b4a04de29dbebfa1484fab13df4cc94dca4c07a00f51ac918f88f2c4637bbc969b59fe558d59c4ba1a7bab3de8cf1b18defd2cb977ef96e7c37d1dd2039286ce620638b02ced769a78b3e61601f2166f5473c16d5fd0eeb84d014f421052f2ab5b85664a2b503318dbe3d1b7111442617cfca5b65ae1b4b26bd8a4301ceec2c664bcf83caeab617ae1078915d479fe400d8b1f9d7bfb2cb5750818464b5c</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Active IDEAL</title>
    <link href="https://blog.yanxlg.cn/396e831/"/>
    <id>https://blog.yanxlg.cn/396e831/</id>
    <published>2020-01-13T01:57:44.000Z</published>
    <updated>2020-05-27T07:57:45.739Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>JetBrains 系列软件在开发圈中越来越普及，相对来说在实用性方面是最受开发人员环境的，虽然在某种程度上被<code>VSCode</code>反超，然而<code>VSCode</code>是一款免费工具，而<code>IDEAL</code>是一款收费工具，目前仅支持教育免费，通常我们并不会去购买其激活码，因为太过昂贵，最多会在淘宝上购买第三方激活码，更多的是在放上搜索可用的激活码，但是对于最新版来说网上的激活码都已经失效，生成激活码的网站也已经关闭了生成功能，本文介绍目前可用且生成属于自己的activation code的方法。</p><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><ol><li><a href="https://zhile.io/custom/license" target="_blank" rel="noopener">code 生成</a></li><li>代理包下载：<ul><li><a href="https://pan.baidu.com/s/1FGZ9d5J5amnvf0vMFqSOsQ" target="_blank" rel="noopener">百度网盘下载</a> 提取码：<code>mmk6</code></li><li><a href="https://onedrive.live.com/?authkey=%21AMIXXkzI4CJfIm8&cid=1CAC1C9786CFFED7&id=1CAC1C9786CFFED7%21892&parId=1CAC1C9786CFFED7%21891&action=locate" target="_blank" rel="noopener">OneDrive</a></li></ul></li><li>下载成功后启动需要激活的软件，选择<code>试用</code>进入软件主界面。</li><li>点击Help-&gt;Edit Custom VM Options，编辑软件配置文件，添加<code>-javaagent:E:\webStorm\jetbrains-agent.jar</code>,具体地址为你解压文件地址。</li><li>点击Help-&gt;Register输入第一步中生成的activation code激活即可</li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>详细使用步骤可以参考下载包中pdf文档</p><blockquote><p>本文作者： Neo Peng<br> 本文链接： <a href="https://zhile.io/2018/08/25/jetbrains-license-server-crack.html" target="_blank" rel="noopener">https://zhile.io/2018/08/25/jetbrains-license-server-crack.html</a><br> 版权声明： 本博客所有文章除特别声明外，均采用 CC BY-NC-ND 4.0 许可协议。转载请注明出处！</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;JetBrains 系列软件在开发圈中越来越普及，相对来说在实用性方面是最受开发人员环境的，虽然在某种程度上被&lt;code&gt;VSCode&lt;/c
      
    
    </summary>
    
    
    
      <category term="tools" scheme="https://blog.yanxlg.cn/tags/tools/"/>
    
      <category term="IDEAL" scheme="https://blog.yanxlg.cn/tags/IDEAL/"/>
    
      <category term="Activation" scheme="https://blog.yanxlg.cn/tags/Activation/"/>
    
  </entry>
  
  <entry>
    <title>vue</title>
    <link href="https://blog.yanxlg.cn/c0add594/"/>
    <id>https://blog.yanxlg.cn/c0add594/</id>
    <published>2019-12-16T11:24:32.000Z</published>
    <updated>2020-05-30T05:49:55.979Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Vue 作为近两年跟React几乎并驾齐驱的前端框架，其在前端开发中的地位是尤其重要，其轻量、易用、灵活、入门简单的特点收到很多前端开发者的推崇，本文主要揭秘Vue的架构、响应式原理、状态更新及vue@3重大更新。</p><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>Vue是<code>MVVM</code>架构的最佳实践,是一个<code>JavaScript MVVM</code>库，是一套构建用户界面的渐进式框架。专注于 <code>MVVM</code> 中的 <code>ViewModel</code>，不仅做到了数据双向绑定，而且也是一款相对比较轻量级的JS 库。因此说到Vue架构不得不说<code>MVVM</code>。<code>MVVM</code>是目前前端主流架构之一，其从<code>MVC</code>演变而来，演变过程为<code>MVC-&gt;MVP-&gt;MVVM</code>。<code>MVVM</code>模式图如下：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./mvvm.png" alt="MVVM"></p><ol><li><code>MVVM</code> 由 <code>Model</code>,<code>View</code>,<code>ViewModel</code> 三部分构成，<code>Model</code> 层代表数据模型，也可以在Model中定义数据修改和操作的业务逻辑；<code>View</code> 代表UI 组件，它负责将数据模型转化成UI 展现出来，<code>ViewModel</code> <code>是一个同步View</code> 和 <code>Model</code>的对象。</li><li>在<code>MVVM</code>架构下，<code>View</code> 和 <code>Model</code> 之间并没有直接的联系，而是通过<code>ViewModel</code>进行交互，<code>Model</code> 和 <code>ViewModel</code> 之间的交互是双向的， 因此<code>View</code> 数据的变化会同步到<code>Model</code>中，而<code>Model</code> 数据的变化也会立即反应到<code>View</code> 上。</li><li><code>ViewModel</code> 通过双向数据绑定把 <code>View</code> 层和 <code>Model</code> 层连接了起来，而<code>View</code> 和 <code>Model</code> 之间的同步工作完全是自动的，无需人为干涉，因此开发者只需关注业务逻辑，不需要手动操作DOM, 不需要关注数据状态的同步问题，复杂的数据状态维护完全由 <code>MVVM</code> 来统一管理。</li><li>特点：<ul><li>双向数据绑定</li><li>数据与视图层分离</li></ul></li></ol><h2 id="Vue原理"><a href="#Vue原理" class="headerlink" title="Vue原理"></a>Vue原理</h2><p>Vue原理相对于React来说比较简单易懂，源码也没有React那么复杂，整体调试过程和阅读过程比较清晰，具体原理图如下：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="./design.png" alt="Vue原理图"></p><ol><li><code>Vue</code> 是采用 <code>Object.defineProperty</code> 的 <code>getter</code> 和 <code>setter</code>，并结合<code>发布订阅模式</code>来实现数据绑定的。当把一个普通 Javascript 对象传给 Vue 实例来作为它的 data 选项时，Vue 会递归遍历它的属性，用 <code>Object.defineProperty</code> 将它们转为 <code>getter/setter</code>。用户看不到 <code>getter/setter</code>，但是在内部它们让 Vue 追踪依赖，在属性被访问和修改时通知变化。</li><li><code>Observer</code>： 数据监听器，能够对数据对象的所有属性进行监听，如有变动可拿到最新值并通知订阅者，内部采用Object.defineProperty的getter和setter来实现。</li><li><code>Compile</code>： 指令解析器，它的作用对每个元素节点的指令进行扫描和解析，根据指令模板替换数据，以及绑定相应的更新函数。</li><li><code>Watcher</code>： 订阅者， 作为连接 Observer 和 Compile 的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数。</li><li><code>Dep</code>： 消息订阅器，内部维护了一个数组，用来收集订阅者（Watcher），数据变动触发notify 函数，再调用订阅者的 update 方法。</li></ol><p>Vue原理中比较重要的就是双向绑定实现、响应式实现、发布订阅模式、nextTick、updateQueue，下面我们分别进行介绍。</p><h2 id="双向数据绑定"><a href="#双向数据绑定" class="headerlink" title="双向数据绑定"></a>双向数据绑定</h2><p>Vue中双向绑定是通过<code>defineProperty</code>实现的，下面我们介绍简单的双向绑定实现：<br>首先，我们需要了解Object上属性劫持方法：Object.<code>defineProperty</code>和Object.<code>defineProperties</code>。这两个方法可以实现对象中属性<code>getter</code>和<code>setter</code>方法定义，从而实现属性的劫持，例如：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'hello'</span>,&#123;</span><br><span class="line">  <span class="keyword">get</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//我们在这里拦截到了数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"get方法被调用"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>:<span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//改变数据的值，拦截下来</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"set方法被调用"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">obj.hello<span class="comment">//输出为“get方法被调用”，输出了值。</span></span><br><span class="line">obj.hello = <span class="string">'new Hello'</span>;<span class="comment">//输出为set方法被调用，修改了新值</span></span><br></pre></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get方法被调用</span><br><span class="line">set方法被调用</span><br></pre></td></tr></table></figure><p>可以从这里看到，这是在对更底层的对象属性进行编程。简单地说，也就是我们对其更底层对象属性的修改或获取的阶段进行了拦截（也可以称之为对象属性<code>钩子</code>）。<br>在这数据拦截的基础上，我们可以手写数据的双向绑定：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'hello'</span>,&#123;</span><br><span class="line">  <span class="attr">get</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"get方法被调用"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>:<span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>).value = newValue;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'test1'</span>).innerHTML = newValue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'test'</span>).addEventListener(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  obj.hello = e.target.value;<span class="comment">//触发它的set方法</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  obj.hello=<span class="string">"reset"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mvvm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"reset()"</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test1"</span> <span class="attr">style</span>=<span class="string">"display:inline-block"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在线演示demo1：</p><div id="mvvm">    <input v-model="text" id="test"></input>    <button onclick="reset()">重置</button>    <div id="test1" style="display:inline-block"></div></div><script>    const obj = {};    Object.defineProperty(obj, 'hello', {        get: function () {            console.log("get方法被调用");        },        set: function (newValue) {            document.getElementById('test').value = newValue;            document.getElementById('test1').innerHTML = newValue;        }    });    document.getElementById('test').addEventListener('input', function (e) {        obj.hello = e.target.value;//触发它的set方法    })    function reset(){        obj.hello="reset";    }</script><p>根据上面我们简单的实现了一个双向绑定功能。这是Vue的基础，Vue中的响应式本质上就是跟上面一样，下面简单实现Vue中的响应式代码。</p><h2 id="响应式实现"><a href="#响应式实现" class="headerlink" title="响应式实现"></a>响应式实现</h2><ol><li><p>定义Vue的data的属性响应式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span> (<span class="params">obj, key, value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj,key,&#123;</span><br><span class="line">    <span class="attr">get</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"get了值"</span>+value);</span><br><span class="line">      <span class="keyword">return</span> value;<span class="comment">//获取到了值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>:<span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(newValue === value)&#123;</span><br><span class="line">        <span class="keyword">return</span>;<span class="comment">//如果值没变化，不用触发新值改变</span></span><br><span class="line">      &#125;</span><br><span class="line">      value = newValue;<span class="comment">//改变了值</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"set了最新值"</span>+value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的obj我们这定义为vm实例或者vm实例里面的data属性。</p><blockquote><p><code>defineProperty</code>这个方法，不仅可以定义obj的直接属性，比如obj.hello这个属性。也可以间接定义属性比如：obj.middle.hello。这里导致的效果就是两者的hello属性都被定义成响应式了。</p></blockquote></li><li><p><code>observe</code>方法循环调用响应式方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span> (<span class="params">obj,vm</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    defineReactive(vm,key,obj[key]);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Vue初始化实例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.data = options.data;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">this</span>.data;</span><br><span class="line"></span><br><span class="line">  observe(data,<span class="keyword">this</span>);<span class="comment">//这里调用定义响应式方法</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> id = options.el;</span><br><span class="line">  <span class="keyword">var</span> dom = nodeContainer(<span class="built_in">document</span>.getElementById(id),<span class="keyword">this</span>);</span><br><span class="line">  <span class="built_in">document</span>.getElementById(id).appendChild(dom); <span class="comment">//把虚拟dom渲染上去 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在Compile方法中处理<code>v-model</code>指令：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compile</span>(<span class="params">node, vm</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/g</span>;</span><br><span class="line">  <span class="keyword">if</span>(node.nodeType === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> attr = node.attributes;</span><br><span class="line">    <span class="comment">//解析节点的属性</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt; attr.length; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(attr[i].nodeName == <span class="string">'v-model'</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> name = attr[i].nodeValue;</span><br><span class="line">     </span><br><span class="line">        node.addEventListener(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(vm[name]);</span><br><span class="line">          vm[name] = e.target.value;<span class="comment">//改变实例里面的值</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        node.value = vm[name];<span class="comment">//讲实例中的data数据赋值给节点</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>在线演示demo2：</p><div id="mvvm1">    <input v-model="text" id="test1">&#123;&#123;text&#125;&#125;    <div>&#123;&#123;text&#125;&#125;</div></div><script> function nodeContainer(node, vm, flag){  var flag = flag || document.createDocumentFragment();  var child;  while(child = node.firstChild){    compile(child, vm);    flag.appendChild(child);    if(child.firstChild){      // flag.appendChild(nodeContainer(child,vm));      nodeContainer(child, vm, flag);    }  }  return flag;}//编译function compile(node, vm){  var reg = /\{\{(.*)\}\}/g;  if(node.nodeType === 1){    var attr = node.attributes;    //解析节点的属性    for(var i = 0;i < attr.length; i++){      if(attr[i].nodeName == 'v-model'){        var name = attr[i].nodeValue;        node.addEventListener('input',function(e){          vm[name] = e.target.value;        });        node.value = vm[name];//讲实例中的data数据赋值给节点        node.removeAttribute('v-model');      }    }  }  //如果节点类型为text  if(node.nodeType === 3){    if(reg.test(node.nodeValue)){      // console.dir(node);      var name = RegExp.$1;//获取匹配到的字符串      name = name.trim();      node.nodeValue = vm[name];    }  }}function defineReactive (obj, key, value){  Object.defineProperty(obj,key,{    get:function(){      console.log("get了值"+value);      return value;    },    set:function(newValue){      if(newValue === value){        return;      }      value = newValue;      console.log("set了最新值"+value);    }  })}function observe (obj,vm){  Object.keys(obj).forEach(function(key){    defineReactive(vm,key,obj[key]);  })}function Vue(options){  this.data = options.data;  var data = this.data;  observe(data,this);  var id = options.el;  var dom = nodeContainer(document.getElementById(id),this);  document.getElementById(id).appendChild(dom);  }var Demo = new Vue({  el:'mvvm1',  data:{    text:'HelloWorld',    d:'123'  }}) </script> <p>实现效果（观察控制台）：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get了值HelloWorld</span><br><span class="line">get了值HelloWorld</span><br><span class="line">get了值HelloWorld</span><br><span class="line"></span><br><span class="line">get了值HelloWorld</span><br><span class="line">HelloWorld</span><br><span class="line">set了最新值HelloWorldj</span><br></pre></td></tr></table></figure><p>通过上面代码我们实现了，在输入框里面输入，同时触发getter&amp;setter，去改变vm实例中data的值。也就是说Vue原理的图例中经过getter&amp;setter已经成功了。上述仅是抽象出的简化代码，真实的Vue代码中还有Dep，Observer以类的形式存在并递归属性等等…，此处不做完全代码拷贝。接下去就是订阅——发布者模式。</p><h2 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h2><p>发布订阅模式在前端开发中用处比较广泛，大部分前端框架中都会涉及到该设计模式，尤其是实时通信框架；那么什么是发布订阅模式？<br>简单点说：例如微信里面经常会订阅一些公众号，一旦这些公众号发布新消息了。那么他就会通知你，告诉你：我发布了新东西，快来看。<br>这种场景下，你就是<code>订阅者</code>，公众号就是<code>发布者</code>。<br>所以我们要模拟这种情景，我们需要</p><ol><li>声明订阅者：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sub1 = &#123;</span><br><span class="line">  <span class="attr">update</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sub2 = &#123;</span><br><span class="line">  <span class="attr">update</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sub3 = &#123;</span><br><span class="line">  <span class="attr">update</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>每个订阅者对象内部声明一个update方法来触发订阅属性。</li><li>声明一个发布者，去触发发布消息，通知的方法：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.subs = [sub1,sub2,sub3];<span class="comment">//把三个订阅者加进去</span></span><br><span class="line">&#125;</span><br><span class="line">Dep.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//在原型上声明“发布消息”方法</span></span><br><span class="line">  <span class="keyword">this</span>.subs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">sub</span>)</span>&#123;</span><br><span class="line">    sub.update();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> dep = <span class="keyword">new</span> Dep();</span><br><span class="line">dep.notify();</span><br></pre></td></tr></table></figure></li><li>声明另外一个中间对象作为调度中心<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dep = <span class="keyword">new</span> Dep();</span><br><span class="line"><span class="keyword">var</span> pub = &#123;</span><br><span class="line">  <span class="attr">publish</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    dep.notify();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">pub.publish();<span class="comment">//这里的结果是跟上面一样的</span></span><br></pre></td></tr></table></figure>实现效果：<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure></li></ol><p>到这，我们已经实现了：</p><ol><li>修改输入框内容 =&gt; 触发修改vm实例里的属性值 =&gt; 触发set&amp;get方法</li><li>订阅成功 =&gt; 发布者发出通知notify() =&gt; 触发订阅者的update()方法<br>接下来重点要实现的是介绍Vue是如何更新的。</li></ol><h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>上面介绍了发布订阅模式，在前端中说到发布订阅模式就会联想到观察者模式，两者的界限比较小，容易混淆，但两者之间确实存在明显区别，观察者模式是直接观察数据源，数据元更新时观察者直接收到通知；而发布订阅模式中间会存在一个名叫<code>调度中心</code>的中间层，观察者的监听事件都是注册到<code>调度中心</code>，发布者更新后会通知<code>调度中心</code>，<code>调度中心</code>根据数据源变化通知相应的观察者，同时在<code>调度中心</code>里可以进行一些派发检测等逻辑处理，例如实现部分消息不下发</p><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>从原理图中可以看出，Vue的更新分为异步和同步，核心代码在queueWatcher方法中</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">queueWatcher</span> (<span class="params">watcher: Watcher</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> id = watcher.id</span><br><span class="line">  <span class="keyword">if</span> (has[id] == <span class="literal">null</span>) &#123;</span><br><span class="line">    has[id] = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (!flushing) &#123;</span><br><span class="line">      queue.push(watcher)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// if already flushing, splice the watcher based on its id</span></span><br><span class="line">      <span class="comment">// if already past its id, it will be run next immediately.</span></span><br><span class="line">      <span class="keyword">let</span> i = queue.length - <span class="number">1</span></span><br><span class="line">      <span class="keyword">while</span> (i &gt; index &amp;&amp; queue[i].id &gt; watcher.id) &#123;</span><br><span class="line">        i--</span><br><span class="line">      &#125;</span><br><span class="line">      queue.splice(i + <span class="number">1</span>, <span class="number">0</span>, watcher)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// queue the flush</span></span><br><span class="line">    <span class="keyword">if</span> (!waiting) &#123;</span><br><span class="line">      waiting = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !config.async) &#123;</span><br><span class="line">        flushSchedulerQueue()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      nextTick(flushSchedulerQueue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当为同步更新时立即执行flush，输出更新，当为异步时，延迟更新，等待下一帧再输出更新，同步异步与React中类似，事件模型和生命钩子中都是异步，即进行状态更新合并后更新视图，而在定时器，Promise等异步操作中则立即执行视图更新，视图更新过程主要时Virtual DOM diff，当然与React不同的是在diff阶段Vue做了一层优化，即Vue是以组件为单位进行遍历，而React是从根节点判断哪些不需要更新，React中需要自己通过<code>shouldComponentUpdate</code>或者<code>memo</code>实现更新逻辑判断。因此才有<code>Vue速度比React快</code>的说法，当然这个快其实是基于内存开销的基础上的，而React由于JSX的影响，暂时无法做到局部更新Virtual DOM，从而在React16+中推出时间分片、异步渲染的方式进行优化。</p><h2 id="nextTick原理"><a href="#nextTick原理" class="headerlink" title="nextTick原理"></a>nextTick原理</h2><p>首先看Vue中的源码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* @flow */</span></span><br><span class="line"><span class="comment">/* globals MutationObserver */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">'shared/util'</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleError &#125; <span class="keyword">from</span> <span class="string">'./error'</span></span><br><span class="line"><span class="keyword">import</span> &#123; isIE, isIOS, isNative &#125; <span class="keyword">from</span> <span class="string">'./env'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> isUsingMicroTask = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> callbacks = []</span><br><span class="line"><span class="keyword">let</span> pending = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushCallbacks</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  pending = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> copies = callbacks.slice(<span class="number">0</span>)</span><br><span class="line">  callbacks.length = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; copies.length; i++) &#123;</span><br><span class="line">    copies[i]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Here we have async deferring wrappers using microtasks.</span></span><br><span class="line"><span class="comment">// In 2.5 we used (macro) tasks (in combination with microtasks).</span></span><br><span class="line"><span class="comment">// However, it has subtle problems when state is changed right before repaint</span></span><br><span class="line"><span class="comment">// (e.g. #6813, out-in transitions).</span></span><br><span class="line"><span class="comment">// Also, using (macro) tasks in event handler would cause some weird behaviors</span></span><br><span class="line"><span class="comment">// that cannot be circumvented (e.g. #7109, #7153, #7546, #7834, #8109).</span></span><br><span class="line"><span class="comment">// So we now use microtasks everywhere, again.</span></span><br><span class="line"><span class="comment">// A major drawback of this tradeoff is that there are some scenarios</span></span><br><span class="line"><span class="comment">// where microtasks have too high a priority and fire in between supposedly</span></span><br><span class="line"><span class="comment">// sequential events (e.g. #4521, #6690, which have workarounds)</span></span><br><span class="line"><span class="comment">// or even between bubbling of the same event (#6566).</span></span><br><span class="line"><span class="keyword">let</span> timerFunc</span><br><span class="line"></span><br><span class="line"><span class="comment">// The nextTick behavior leverages the microtask queue, which can be accessed</span></span><br><span class="line"><span class="comment">// via either native Promise.then or MutationObserver.</span></span><br><span class="line"><span class="comment">// MutationObserver has wider support, however it is seriously bugged in</span></span><br><span class="line"><span class="comment">// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It</span></span><br><span class="line"><span class="comment">// completely stops working after triggering a few times... so, if native</span></span><br><span class="line"><span class="comment">// Promise is available, we will use it:</span></span><br><span class="line"><span class="comment">/* istanbul ignore next, $flow-disable-line */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Promise</span> !== <span class="string">'undefined'</span> &amp;&amp; isNative(<span class="built_in">Promise</span>)) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve()</span><br><span class="line">  timerFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    p.then(flushCallbacks)</span><br><span class="line">    <span class="comment">// In problematic UIWebViews, Promise.then doesn't completely break, but</span></span><br><span class="line">    <span class="comment">// it can get stuck in a weird state where callbacks are pushed into the</span></span><br><span class="line">    <span class="comment">// microtask queue but the queue isn't being flushed, until the browser</span></span><br><span class="line">    <span class="comment">// needs to do some other work, e.g. handle a timer. Therefore we can</span></span><br><span class="line">    <span class="comment">// "force" the microtask queue to be flushed by adding an empty timer.</span></span><br><span class="line">    <span class="keyword">if</span> (isIOS) setTimeout(noop)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isIE &amp;&amp; <span class="keyword">typeof</span> MutationObserver !== <span class="string">'undefined'</span> &amp;&amp; (</span><br><span class="line">  isNative(MutationObserver) ||</span><br><span class="line">  <span class="comment">// PhantomJS and iOS 7.x</span></span><br><span class="line">  MutationObserver.toString() === <span class="string">'[object MutationObserverConstructor]'</span></span><br><span class="line">)) &#123;</span><br><span class="line">  <span class="comment">// Use MutationObserver where native Promise is not available,</span></span><br><span class="line">  <span class="comment">// e.g. PhantomJS, iOS7, Android 4.4</span></span><br><span class="line">  <span class="comment">// (#6466 MutationObserver is unreliable in IE11)</span></span><br><span class="line">  <span class="keyword">let</span> counter = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(flushCallbacks)</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(<span class="built_in">String</span>(counter))</span><br><span class="line">  observer.observe(textNode, &#123;</span><br><span class="line">    <span class="attr">characterData</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  timerFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    counter = (counter + <span class="number">1</span>) % <span class="number">2</span></span><br><span class="line">    textNode.data = <span class="built_in">String</span>(counter)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> setImmediate !== <span class="string">'undefined'</span> &amp;&amp; isNative(setImmediate)) &#123;</span><br><span class="line">  <span class="comment">// Fallback to setImmediate.</span></span><br><span class="line">  <span class="comment">// Technically it leverages the (macro) task queue,</span></span><br><span class="line">  <span class="comment">// but it is still a better choice than setTimeout.</span></span><br><span class="line">  timerFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setImmediate(flushCallbacks)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Fallback to setTimeout.</span></span><br><span class="line">  timerFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(flushCallbacks, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span> (<span class="params">cb?: Function, ctx?: Object</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _resolve</span><br><span class="line">  callbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.call(ctx)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        handleError(e, ctx, <span class="string">'nextTick'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_resolve) &#123;</span><br><span class="line">      _resolve(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">    pending = <span class="literal">true</span></span><br><span class="line">    timerFunc()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// $flow-disable-line</span></span><br><span class="line">  <span class="keyword">if</span> (!cb &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">Promise</span> !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      _resolve = resolve</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过上面源码可以发现，nextTick本质上就是创建一个异步任务，通过创建下一轮任务队列执行的任务来延迟函数调用，通过<code>Promise.then</code>、<code>setImmediate</code>、<code>setTimeout 0</code>等手段实现，具体js中任务队列相关可以阅读<a href="/h5/eventloop.html">js 事件驱动</a></p><h2 id="Vue3-0-变化"><a href="#Vue3-0-变化" class="headerlink" title="Vue3.0 变化"></a>Vue3.0 变化</h2><ul><li>全面支持<code>typescript</code>：源码完全采用typescript开发</li><li>使用<code>Proxy</code>代替<code>Object.defineProperty</code>：放弃低版本浏览器，使用新的api来实现数据劫持功能，有效提升效率并降低内存消耗，低版本浏览器中如果不支持<code>Proxy</code>需要引入额外lib</li><li>Virtual DOM 重构：在原有的优化基础上将模版中节点分为动态和静态节点，在更新时以组件为单位，遍历动态节点，vue3.0将 vdom 更新性能由与模版整体大小相关提升为与动态内容的数量相关</li><li><code>Function_based API</code>：引入React中函数式编程思想，解决原有写法中this属性类型声明问题，同时替代<code>mixins</code>实现代码共享，解决<code>mixins</code>存在的一些问题<ul><li>this属性类型声明问题：data中的属性通过this访问，从代码理解上this应无法直接访问data中属性，不符合代码正常逻辑</li><li><code>mixins</code>问题：mixins 的最大缺点在于我们对它实际上添加到组件中的行为一无所知。这不仅使代码变得难以理解，而且还可能导致名称与现有属性和函数发生冲突</li></ul></li><li><code>nextTick</code>实现调整：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn?: () =&gt; <span class="built_in">void</span></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fn ? p.then(fn) : p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><code>nextTick</code>从原来的多种方式变成了仅用Promise来创建微任务的方式，主要由于主流浏览器都已经支持Promise，兼容性写法已经没有必要，减少兼容代码有效减少vue体积</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上分析仅个人针对源码理解，如有错误，欢迎提出交流，无法保证与最新版本完全符合，目前Vue@3在Beta迭代中。</p>]]></content>
    
    <summary type="html">
    
      Vue原理分析,Vue双向绑定,Vue状态更新
    
    </summary>
    
    
      <category term="vue" scheme="https://blog.yanxlg.cn/categories/vue/"/>
    
    
  </entry>
  
  <entry>
    <title>svg</title>
    <link href="https://blog.yanxlg.cn/3452590/"/>
    <id>https://blog.yanxlg.cn/3452590/</id>
    <published>2019-11-26T03:30:31.000Z</published>
    <updated>2020-05-10T10:01:06.155Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="c3103aed2d8916992cec4f848d8f31b7bbda9b7053f36670e3a1356bcc6ffa3e">76a7c2d69f910a96efe6d4a85086bd083b71be6382a756a0ea08c2f18f8205b2dc5f7b340d04aefbcab27741555ea0fefdf4afea40a8d8f3349545a73a10a806f501c971e515c7af4c7987e626c74cdcd22e80972518f32ca2f13c9d6066565a68e4a26092d116f76526bd36abb05efd65eaad7a497ee9f862969bb026243f2f0c9509dcd011cb589472109e5f201457a2e4687876f82b3030baf1d2777e00306b4af26f4fd89b65fd5fc7197663c5fee09f23e5a0c91369e0fbbdb91231e070b0df06e56150c6541bf612c7461470fdba358c18eff2a49b95d70edf5e91cc12ecd2569219ee16af7c5f0cef1c1d190c89fadfafad4638358c7f45775a7e4142fad1b734f4c16f7646e1d8b0e3218b5436c7eab07dc0de8a4fc8c3a4af6cc6fabd4e5ff544ab5b4f211d7b2795328b2e73a8cb024c646a44fed5909d3768847f2bbe9211924b0fdf39b07cc1bef592afb3524707f510300f5386ba1f202f3f1ef57b483a76d15fa8c4be9dad882ae87b782825f880577f82d2656a082ed89f56f7ff4ccc9745e4b7c69d6e9462530517e752b2bccc63f34a3af39a85dad9fb25c4af0cbcf17a8c7a8b4a0941b8f53fa95342abad68c4043c9f0cad42dab46b5f3454b0ca404792c587ebf6c1f7e53b3030dccfa660242f6a4e75254f53f7447395515535bf79525cab80234828bbb85820758b70e9f4684813756da72952bca7f974418f6e267aaaee60a77567981dc3eceb887b4f3f6824267fd48adcbda71e60efb91c737513a7710dc87ca719b3fa0c28ea3d3da98379e55024d2aca62da0aa1e8d18bd293feb03cf5930d2f4df0468eb91dc1b9b694ff76cfaea204a5e9eec42dac345a5c87f16417b065c4f85ae25487688dfc27dfeeca725202102e05725276edb68559f2f034b04ed183b55ecbf5118e5f7120c0c0b46214db566b867019295ef21bf44ff60ae342aa3641db8fc6d55df65724c23acb40aee915b2d22e91360dee6a30cd372e41b2708d6ece91db3996be58c4e0985652924f8af2dab5d8060b626005d3bf5fde1c88b9c404e583ae21c0b59041cfbeb079f82d6b65989e758d8784e1e9151bdd426755c64a2cd3f44d1554ccacec1dea8eef23cfb98d56c099c34a35e5236afba81098e7f7ba10939326c12e580fa258d2165a9d95235d6cd58b3475be7e28672774455bd86f6426f7d0ef522e029dd8f3b880bffa0999c5f5f1adbf83292eb8fcc7f793aa3359c84a374d2a36f4c7c2c83ea53e890d5be24533d903eded1a8adc0440806f788672513786093f37183b21bb92971823548040a83422aaf3937abb156b43dccf0db68887634709e51cd948a7ee7884aa97e08a770500e4690eea2d3a5bdbe7f4e2fcd6558f2f1e35f902e9785e42a0b6b461515a6957672e91381147649c94c139006dafd5ea279ec10d35fee9e6dea91626d6fd0cc107d4cfd9f34b7af610320d0273b257d344bc4a5f3873e1ab5551dfad3cb08c3d6091d4cec99513039cbaaa42c6b614e158d61e59a63d6078f709b0af4a01092441758afcd524308c0df5acb82a36adb0287df60eb2d64296781e62c2769a2423aaf9d9c2f132be317c75c4efb020546105771005f3398687134849119dbfb20a1d63635810df3f993526d3ad18af0d5182c765495bf813f74c657482e62835c591c5a0a05f8884c5afb8b770be12875edfc7da8304838bd2891df7a2b50d136b0e28c84faf2a2b8528e3e29bce3d8f20ee417bf9c2d65af7905</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
      <category term="react-native" scheme="https://blog.yanxlg.cn/tags/react-native/"/>
    
  </entry>
  
  <entry>
    <title>webpack</title>
    <link href="https://blog.yanxlg.cn/b9f20a20/"/>
    <id>https://blog.yanxlg.cn/b9f20a20/</id>
    <published>2019-11-18T01:09:05.000Z</published>
    <updated>2020-05-12T10:18:40.197Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="ddd359b63d36ff6b3231cd83cd1da9056063c1b97298542cc901654b498b02d5">76a7c2d69f910a96efe6d4a85086bd083b71be6382a756a0ea08c2f18f8205b2dc5f7b340d04aefbcab27741555ea0fefdf4afea40a8d8f3349545a73a10a806f501c971e515c7af4c7987e626c74cdcb832c4e23ba4d7175b3091505428e650ef64681ebc3299cfeb34ac387b069b3d743619b7321dd1ee73dc5e398dc19240f0e0c67f23e2ecd5095468ab1c02cb88547c2ba1a9f4fbaf060853c04a2aa7ed4b697a9a47df674e299619d9c5000da74d9051a7a2a6241661aebbda512f3a0a4508c724dfe357d2d89859bc0c251da96ae60ced778a5c1d20b806e2c90c16a8c8764f492ed027f3fa1373e216b2b8cd80b39949aa8b2b59d94245d9655bf954f939998876b98ec4ff42839325a4a87cf068d5d99fcfa984714e61f4f1f39f791b9b0582671ccf6389d7468cfb528031c9584f912c9ee72ba0b5c17ad8aff10d56a6edc52227ffdaced0d522061351c77ed22923ed1027207bd8709ac10e2839557aa34c175d605d010b6ad730892cbffddc4ba6dd51cc049450b270ad0f90f45cd0b7de44367ac991d4d128b1ff1705dec9da443481cdc5fc9088638e5204b9a7718721650531cdd3fba653eb45eeee8000f69b549f1b6bf32076898ff7d703c82158533fe8fdc48c823148d145e40a1e9097c4d3ecff3aba6423a41bae56ca3ef1e6456fd9c8009c24f4ecc46945484da5c5f777e3fc50c3f2e2196459fe9a2d7e8bb84aed973a125806ee0a0483874e057156b10d746d8a034d4323cd9a23005f973067726758f6979281e8038a6b93a839bea70571008d07e9299bb7068364541789ff1282bb83aa06deaa3adb66eeb314aca12af563a0b5a124b96dccda7b76f438647e1815f3123350e89ec920051259f52ca1e150da22fbf4ccb6ba2a55268dbb8d3c92f7a15f7d57b82257c66493ee91c0adc44b44a0ce8d8c2e6e56b9747a24de34e3821c547745be807f9cff997bbca5c6d678e36c372031d04d87df5abee7a0c4bfcd198d6c003c7a7ac1dfecf8c5db370506f04711ff72a50f2702f1725c844b106eaf82a06239c0cdbc37376c786bddb7f7b934276758976953f6144c0318c1586e3d6a1c3cb1a104a791ce55468d0b7304f8eb5c11ba6fc295ed32af84e662e837eec2ef7b12d4bbd6362ad8b6990332d4bf74c8235db98bf64f69ecb3a21c02d9117c571092f81378c710a9f55e8f5c6147fbd47b46a50aa12803c29a7101c8ec03d06fbafc3eaeaf20d4a978a6e3da431038eea20ee9597adc560ec9d2ec42fafc00ecc7319a6296b90fdcc9ea007dd0279e497cc35a5d604786fdcab1f5e8550d6049a50b2059b7e472c25f8527efc4e453391d325dcf673fd144676c254bda3f0405697da323259bc63f0add2327d14f0eea14417d3d3cdd50241a120c64adda22c18930c7cacec65d0708bda552b9c585da4463a0cbec1edb9dd0fcb382fe02bfcd592dbae4950c54cf670371971a21afcdd2d34682ad64c49614883cf69e97194efc145a800808bc47622906e88636a8686205596751340c8fef6e6efb00d06dc58ce1d90348059059b432d7d0517ae35920a3a4f9acdafea67b4ce874cb68feb99dd8d1335a5fc6ecc563af0da733179174c5fd783738beced54d3a87dc835e41aa39ac48f7a95a020fb14fb7ac19682f53f0f35e2202edbdef3490924e131246d69e4d4dcfac4e02b9669ab6ec28a4e410e2e121892c22b9346870ac62af98bfe101486144e2d5b94a0b098249d758573f4dee3dcf07add8bbd39c2dcbe1c1f587d2e92cce0973438680dd68e40a11091617a3070942331ee16beebffdd746cf062db5e72e4c833e7f91453fa7ddab42f5631f428b97c61a1621b00913e356d6d9bb8e9e699da7457b6881d3e50c0bc2940d26f9140539d62844147d629afc21fe2effe84d5bc9e69574ca94d0f9f2ceff006a5c1c520fae57c0dd4e954f115777daaf6f01d63392c30582a767313d211ebcc317e30cea3653004328a2e4fe810baec795358683605d6eef5592a695102b1b4a8b2d679a078d5ccf55557ebd8e07745b16f581e659d0ecc33f866567d818267884a43f27c9a6227902474af316bd0697e6fd14d3071a6bfd618abd55e7450b6fa343ee41b81ab56796bbfd78381c7d67ef11db1cf4930f720ff1dbb7de7a66519a01b5a3529dd702cfd79d08e6bbb5ec4c9a6aecafb4db70e9dadcb947cd4c33d4a403bda6ee0c2940e1283261f5455ef8ba64418a4b96fa5c8181bd668f59ebd3271e4f454b016b8afd7427fc5150ef9a4204bc61960153554c3e9500c8b997d9ca275b0bd6db143580f10c3dec665028bb65aecdee7224868674a145f429a2c3a59fb7b7cf94aa704670e01601fffca58709e1853aa21dd0364b2c1d6d94ef889dad6b45576de4b9a267b2696a9eb49a9a46bce323399e8c2bc1f2845744683e97c2e32574d790fb321c97e1b8a6f8648569b0ddb4f5a00618bca1f140b1a8d3888ab29e40453471eaf10f387e3f5f8616eb91c0b517706bb31b44ec78397595ec9d92ff28e14edf4a91b42aa84d7b0aef6cf65bbf01d6e42f4b925d0a1e384a75bfee139a8f7cd0f6974657e60428dc4e21651f5d10eee126fca24e11e3afd01c91f225a2c341ccd737434c2d358fa1c74adcda6f001d7adbdc6a24882af43f57a0af07b9a2810916d7d21dda4a3a4cf8b63f8e2df41da953703f5f8b41adb0e6ca3503f38620b62d7f708ee72d007124a5d497c84b7e9321f1e7ccbbbd77f13c769eba1e872df4bf7ef9f19570c67ebfd4de71f9b77c0daac08bb471a72910dccc0a6d188a2499177c304109b48fd6e834fe5f3f8453a7773d0a817b98dd91723c76efceaaaa62eaf5cec76cd27b4ec63e9e5bb2124e5723e9950a5dc6b7fcec140bab38985df78f89deacd33004906406b15db71687e18f1d3067eb814b02629d34a1d0b56ea65337010325559619308defaa6d24c761b8234235deeb3fc954e514ad023894d5c44aa9229a84a6606ca5ccb7d2a01a10caaa6e98a7e6eca4971932d5fcc5310407f229e13f18ac151fe98b4389e04f39fa64fff55184dd35c7aef26efd460adafe008e1ac4209f3c2302e09bffa2fe1def8136cc72cdc73372d6a99e2aee662943a46051f270bcc39824c72bc3a3cb8c098c43d570ed3cb0b5284a8bbd6b5785092cfc8ca169473ca017302e1b271230152560d8a41dc97c795285a2496fe6df2939588d07b8e5682084680901678d7b0b9604a35f8496f8aae3f4fd0729f606cc42b9d7c5cb0afe9273d61c563e61768930ce45d43bf2b0b87a97fe0e2868c2871c61ce5c892f74c722d09ae144f285568927a79fe5e4fac697e14bdeffa2ef7396603b26fe1508a4bcc869426d4f4326376af52687f3c8b6d26199a6e4bda02b39205865809d9fc0895c6a70e5a13aae407fdffc5af26d382eb137d8f2682026c5539470d8c88a0cb390cb38b200d8347682a72239c5f550356e55d7c2bd8a032f6f0f12905d30da0b06495c61787f784cb4577901b164b4e2dcc05abf5cbce943c9fc487041d02d74e4f42736f32a240d5d8de474c6183215c1cd4466cce519708384c29f85115251f39064f7d07ddb1e835a47163f3ac01206e1ec38d1f50acaa722d4b40b19266fadd58d9ecc35c9c6404c7f3fa46bd4c37a3a78179525df2fbc4e70b1ec84c882fa6fb4e5ee40ed107b25845ea494bb09521ea7d99af3af4477f7895026e493f92c8d292fdfacfca681c1f29e9d95e30af5cbe560b259d44671b4534fc3de9d16b63e55e2153b419d8ec9e250069e8c935a501b987e558437d52347fc950f9f9153e41687c26a722f7f818839e1d894f07b2392cfde179839615147feb6d1395c757395e75969626b79d3853a2b64088be12845d23ac2cc0f4187c66d77a151f5b812e16a1d0e6469f5fd994a1b6967c07323afa43f1d8785a6f1583998ec2c70602d756264dde325b44a331b00b3a3a40bdd87baa8ffa6e05b873a86c2474e27798f82e58098823d112d0707575fb8fdf659faf8f5dc55af113685b46961a5c433dff09efbf0342a826a250f20ab35d4fc8f03a7075b9e56f7c04840ab1eb58de0d810dc7edf8f159888b5c748b3bf735d5a6e5df8977a9dca0ce47aa30a85df579407e5dfb58d4a6135ede7dfaa6821803206511785451893d7d4d051c2b4f498cda39cc7b189143f66692255ce749f75fe6e436608cb70816431c3b2baa3df93df027c4a67ce0ee739c6e3afec85ed27c770bda26ca07d0fd14393d386545d07377580e03d04f244e1764ec688962edff3c9525bb06639eb68c972172f730f20e12acf520e32e0edfa3af3e30bf42585b71a12889628638ad4ccef6df2337bd4dbb1e19057d752f66b7574ae3ed5bce0712155a866ade235b8b6dbfdf152b9085b83b7d7c81bbfa73ad496ec74a7a0c53f935c57a97572742c494a94c89aca21af88141f2e556f62a6106967d3593044e6e64877a5f28515ec7d6ae4dd17aaf54bc8b8fd69037c8425b7bc81773619709f67bea7f732d2be6565f1b4a1f0281c19a9252cf6bc310b688060ab8d60fda2ffc4cdc419828014c20b7f913de45f128e9399305bc07775ef91d6fc04061a6c1b0f4d72eaf021bcef8482d5cc3c844621a7e54885e58084baf803eb54889b0db36ecee45c42a96eb343b4c8b2009741f5e73657d951fcba2b7ad03e01e614614bb88a9f5daab74bfc401a2050b4ad350aa2dffefc583a2d2b2107a3528183a82a2dfc7f3d31dafc12d97564e8a98c3fa4b25b413624920141549770415257fc1e164bd8f8dfcb5c7fbc6584bcc4d1be627307303f165eebea0498f7f88d9e78d96bab578461d31559c6d3243575b22fb0862f82e2407163ba4ba70fe5ba2633dd0a773d67d4949a4b3e4c90fc4769e654c10fca5558fd07a1a6949366752a7a764c4443b816e6b5cc59978fb64e0ff9faa92ecb8b9c45e0175b15f8b20a3ba5fcf1b7ce2ed7c0e97b1d72727893de8508a03a15e136ee2c0315bf5da6e3bb6b2950e681745fb3f5885d6105f9eb40be75f42a9757555bc19b7a0747e407ff412f8152b4b1e07caabb23d215af8ce06cb40530806a02eb7d1fa4d881d169de05048f75e4fdc3a3d491c6417d6148cbef03e15537df4a36b943f37e4d015490226f04cb86c832a6106315c3e325b7506ef8360686e55d35651482a9a93630296a506e288c6a04fcc8a355b1345dc382496e1aefbefe10622ac4c21865047e8d7f79aaae64f92bcf5dad1909975dbe924a6413d70a74657898eeabe968321af475279295dc2247a0fea4172fd4658ef94e9059ae034fcba2f1b5b7768e9166c61587e5cdf892dd41aea8d895fa817398495caa88b9b2091e30f81e78572101347436a1039c9d5fd0891e0261763573729b570bfff42235baf5a7dee432e8598a7c64151298b92eeaa87863c23493f8835f22536959fc5357f647016fc5226ab1b95f3202caf891e29c1fdeef7d1487ee67e449d77cf7a73e7c11ecc774fb29339a2c26c01ef1aab82c13c31559685b48de386606e3b7c3c1d0f7d795f863e210dfeee101c6cba12b70411e413eb27c1a6901d989939c74c97d7e977ce738e75bddc9a4794c1c2cd7cdc3dfe0007c4c10847376af3bb1ee761f0342de736d47d82f9c29ac7f9795e40b093ddbff0050ef3a1ed5c434dc34da666d8c599f380dd9f5f995859c70b7feeca5965d2a7c1394a1b632f9d86d81feb96580f673f2539992372d980616fc538c4985913c909942e4eef1e7fd1b2b71c103ef2f85e51f54049672fdd39b566acb6516412063acddc070a165d6cba955688fb872363b4c0d503b3b8ced108360554997654feebc8854af55a2b9ef5e29ddddd0ed65a080e6e9efa85f26d923d41745dbb4d4f3d656dccb6a3ed1ef9bd7137c60831bc79ac801b88f4df4e478223885764e555c53aa549688833cebbb0756835f9b2b1dea13f38a30b51a3f1c2c957d9f29c5670dfd8775f3b6fd8a15b36d7810153b256f526d21b526473fa11b0d10684f0eb118d8b16d066f4f03b96f0f4cbc179e756e00c9c05e2dea5403ba9aebd9481c3e72601bd2a91f9ba01586c1303ea6a40f7c71a5f92583eececa1a0a2264c0d538387b353b327d79d4d0660d1591a8598420587664eef7f2674fe429c09c32ac8e2f3c617333307cf55d10d611cc5199ddb09df20d185a4d38ae7d954df983b6ae3b339ee6048d7e11be0f513a4d898a0673e401adca98470a943b67ee466abd1532d13135fb9124b766d823f98de746ad9083607da8ec09db6a2b6beef9b6d83045b359fa91788a78e127dc5e448e4e3a55ef6ec827185a611bc8418f0bd6b49c5a6d81036a74de27dc6a78e041afe2c38bd6ae22ddeda0d6ba1b8c804bf2e1437b3d6abb92e8a4a5bbc3a20a6448647a02b26ebb6b69c380e5a0159cb6c11d02bafae1a3b87293a9f4fa3718659e385f5c17c625c23762fba5e6c58b0b3d302dac56358ded4397fe9ca2083e2e9d6e0068fc705cdbf603934014c9636e02cab00e24c5faa8e82690f03f82b6665fbf5b7c5502624182c4a7e0429f4dee279ef1bd8a0b797c551ae3fe33f069e31b7baca8386e07741eb986051af31f44afac10371d7400ef68b6e6a68a8b12b16a6982a7d7b1e788cce375fd8537b6d65ab485897fd5a3b59ae627fce205ef464327055c970dda4ac228ed9e12e5de68f1fdfdd4331a6d5f45555442c29b132c3ae1660ae3465bf1a4d460da8c0941bdc59fdfa7e0b67853c2799e968b62cb3fc1e619d164099e9f54afe4072c721ce44cfffecca2ef011ee20fd7fe189bca751e100563993bb05981fdc7ea20c6b50fca27945cffc0227fadc3ad1b82fa9f439df9b1beff92926e6e00c72d77895fb53231b858a4eb2ea6c5b315510185197ec82d492f97829ac930a41374ffac94a02d23a25bf5c6e81a4763d9bd93b2b26ac233ce6b4baaa2bd0b0c3409ee04f47f71020091d713fa53d829410fb6956a2eb5217f0ea00cd36f99c32f8ef3ed02196448062b13572a8c64bb912d4802ec2264bedb879c57949069ae87707bb023d63db3ae375758b7c96d9422d090f33b9c5c4486b370fe174d2b68248926a8d11b133e60bbd9caac223bc220b454e88a0a88723f5f7f70b9258766917af8a5d0e59b615d24ee5e4eb4274e0a1db920471d5bf9c80e094c1838dcf5f9811fc66313de41a3214d04cdc7372357483e2a6041b38e032cf77940b85e20bb582a074588773f966019b7d46a6e840dca1a76492cce29cba0b909cab05e03796b4d45e94ab1cb770bf4731b397b6bff1c3dfd4693a96d35bcea0690a56aed537053268d0447d173321900d635a32af945a6e126e57c53d31f8c38f5281574968bbd8a0ccfee2d2f87db2e4f3905f7193187414b896639f2599b437624f855da85544dbc640663b18835ec2c5f7ad313661b69e588bfd0359a08f79e83a0992a7d8ed4177d38fa942116818b1e45557aa6f42373efa17fde72ce96beb7e2cf97bb3f66c10a61eec67e0f5c4ed9307df968120f45a114e6d39a86fb35f265dbc65f30063d5a4cfc914c1ce41e4aa90458d9a53d991674999e49777cb8a52e5e349ddf98b610094277bbc3f62859cc6aab03e5cf3a7711cc7d0034733531c4ad5423a8b92545606cd0ab0821f98f420f9f45675bd43f1f684c3b07f4406a9295aafe489dbb1fb8faa7458362b8a40bef7eeb1274eaa482d6fee8765021bc7ba355876c17f608df2f0394620ded0a3e1e014a1356fccb6938e2c1d6ddca036b1e6c9f0e8d08eeebfca977d2a7db4772c1f03ba8cd579e98fdbf3d0c3d95697ac86c10b69b941fadd2eb005d851f878747a4aa582afd0bd2d4bf33f3afb3d33b6e71c08121ff1763d5aa147c8ead42c390d1e5bc347e4ad84af809b5c1992c46ef49a563f8db199e0ab5657f2d144b5cdc90f1cdc153eba8d929971d72a8bcae14f539bdf37f9b56f2622f4e008c77c4bc1b9cc08b30c1beaeedab3d623a520fd463c259250d5814aeb6d2f0fe59ef8837ee2a2b27c78453ff5c3641c981c2f68cb0155061117ea01d3633539863df91d7e39b50160f7d832dbfc4f7c4509d9ad539089ff0094176c88b763d4f74ae365fc35ec914bc814b7392ae237c30acc3bcfb50864e2fb452917b6632dc9c4e1403187d714e659ae51b43bf89fdc4751b6ba63b26dff3a513a4e0fd5e175a2b9677cc71b443cbe306f66befdc37cd40623cf393563483518268b62a1b08e361283d1c572edcbd57ac8fa12296e2e5aabd93b52f02c0050349658794fedb79831e854fd0709cd12815ead3c6c67b4c9e540b6fbf4350e67efe32d7d73347abd76113d4baa89f258c3859662101ba16cd62eec246dc3374dc80368aac6c66299c4d6fded5e631e96980b6fa5cca7eab659de7dbbeadea9d64dc0f6562aaff5cf9734c90b4ca58f0beda2b54c8bb16dc415faf9ab085cf421fcb8e41dc881e04b019636bbdd7b3707ca0debf9c7df3dd5ec240e72850c48252f8525a1d5cba326cf91a367c1a976f93facd545ddd439f13da2f27f7a1014b05ffdf606e464eb06ac9b221ec8be2c6cd2380077cd3f3473650dd6909ac92b69fc9e48b8bc49eb597ac058e14490501452191a7ad18f71de8869f8c5705d9d75417d2e5bbe848fca92b389b97c39d42193783ddd01442cda0d3c43a85496600aa77d2d2dd074ce76787e925e72dbb7d90e437ccda965c8f90132c2e905ce353cef14998d03e4ee3c740a42472bf8696745ae5efd2bead23159f0b49005c17d7958fc5263591cca3b16c9b666acbd0a2831b9a8de6b33630ce4d7e755fa8a59c829f2efc5ebc70f17ab49d689c7e5ab3daccad6c0a66cc0c4a11783ab1adc1de9bc8d3fcdcba6bd4fc477bf22bf5679e44917dfe6aa77416c1bd73e69b24f6e8f59109c450bfbe2bef0edcc9f238bdb5f51954d4c44d2fbcb7895bacb8dc90bb6d54a7e05394e1945ae1ea857f442f5fa3d1dfc42dc1b6ab9ab894ad92dc4946db6f21595f11c9e0ce5f8686ad0d69275167f56320b41aac919cbca4257b61f8b7a0a25ed3b23aba8785ac97d8d10999d4397e63e6a60a0842aa7104d121709ddb04393fda24112da02c7930b8d49a6c6b8816e1c57e7a2c54e78b99741b5b4fd81395682b4d229e3440dad483f4316bb824ac3c7ae96ab558f885bc87237d1a97def8f2afcbb1f34791dc663d81dfd4be5dd608d59ae412695626a6fbcf55309ebfb8d0e5ab0881b148b7a47d9f7262c4bf0a4853f65ccff06aecf9af1f354db31cf5d89db18cccc9087eaf5207ea0189f0dc2e6c9dce1d731efd565c9de03ba59b3d67ab176f4286c7083fd85afb20c4a1a0d0b9c291eb6f3c70d4eefaaf35074d60013b8ee18e6b02c9c41bc26ec271b2826defd51b353f4a8500bf2c7ec70b18f530deb974d1245ef59fef980987fdae22ba26e51280b86e56a52ad0da0eb5c26b5ddce1c89c74c1bc009cdbf7662d5039b5b5d2cbdb90512c9e5f60295a2c17f37f72a66b0ed532cecc5f5072ef11820b3ef744b10370b244d8efc711342ac79a2ebd2a21ea70ccc8ee45a470d8e19d736e897c980253c508006ad87acfe0650a228b80cb95c78dd42e36e27ec2fd7c37d061ff50f2c839de85061e62fe01925b93a21365bc91bd1048dbcdc0e775cf890ba727fddb093b2684b07e0092ab59bc6274041e95b8e5e7403afe020ebe7ae47bed50b108b5ce9fba9e7b0a854ff3a82d48746f0d2f79ddc67d6639b2330ccd13f575cdd707e062fea1750d0452ec1bc3c042f152fb57bea236d71590509f5cc498104debfafeddb141ceb301da8629a55bc1137df6bdb82e2d07d27dc0fafa2c80d9648982ed4aa7c86b3ed0c9164c8c8a8e1a7b976f02815418cb9eeeca4ce5683c66d4e1239f55135fba21e9af0ae547f69355efa8ff9a98a0ea551a1fc13dc41a2e164fb9b5e25880951a0e7fa77c70c5515f9195064136e815a048c1974e876c57f03fd72a36f030c100ef0727cf60a111084fb2eb74f209ded273f62fa85d73f441a64c07f82e27aa92f9b7ba900e4aba9cf7ae02c1199ec94a8a8f57cf3e4a94e9c02dbad60a626fbc7e028a72837cba3fb2bf86e89a5458ccdd05abab427f267a3288723cc95283679590437326e6f167ad277bfdd81b0bb70f61641540d04e68f347c0c7dfdf990ec4bb81f0216ce206944bc396e78c0fd73e5a63a96c2a27f6992ca865db21e823726c59efb02d7727dfe0fe107e479317a527d47a03c11e83136df47ad181f23fdda81d36ade6dc9ef34a73fc5fd0289beaf03ca5a3f354193372b6fd650fcb49469aa975f3090da88630d743ed3c50a36c69025045cdb722205bb2d504554942bbd3d63765dd799077d414f50a4f57cab887c8061f31672eeac96c6b404c397d148b2c4cbb2e0d5f5438d243e834deec50bed34dc1e89f5c2f988440b108cbdc75ae5e0f023b2130f9c116897a75b438d58b22fcb8225d393f97f590200dfa2a06c2bdd1e714b7bc4df36421a76e73efc0d076246068ff10597c0d0860ceecac7ffe22444c00ecb07d4906360580f57e729c0b6b03da10e500444328d0d89c59af0fc344e7c601d1c598c421c2abe5dab1390d53e0aa2f758b21402bf49902b3983b0b18c2f9ee15c70663483cad75f8f9811fff6f22ed6a067dbd5d99522f63fdb2e891cb009f91f3d5ed2512df8827c63d617d3982472abd1e1a2bddfeca850dd4ed108aafe174c70e86a4df6568c620c35bf209b86db56191e83be52e8d66011d980ceece939b5c659acb45b242b67324716ca5e6bcfce6db797a06e8542016b4575182d933c5b3d7ef671043c50fbb07d758b729f1b81ec740e0fe5dbfb952ad293682c991fe1385eb4ed0e41a438eab35094410a728c79efacd20cf60deff265e7b735cc448f8cf741d69d98832da70419ad14d3625a00901fcf41ffe8dc49dfc12c7705d9ca97964cac9f3862f5043be07d28fc603fb4bafb9a6455fdb39efde9afdd442b9b6f4720c76069bc1f9bab63744f8ba4769e457d85249f69b59bd406db2cf92fbfb7bcf884be1035bb5f3798c84da7a69890640bbc61127ad6d36c29d83a8b5e066bc6f601ea66f82eefd7ea1cbf72acd687936ea8df2da427cbd09a7a32d20982e581e9909c9b36a818e1c8d1be5d1481762fef64f5e5106c6d698a00284b35284c881bb6c0744d0c564b8a5aeb1deff6a9cb3676c9bbb03a9a94ef088f11a7f0667b360222f8e4c29ce2805213c2342e18bed463b202ffff49cb4688b88c4edcdf31f37e7fee3a2dcfe0b9c7ba6f883d70186dda2b474b3ec8e63b81e72a8fed72f79b0ef5ea22fa47d89def244ed0a1d5c5aa7178c1c3ed2cbd4498d823f3650a9e0b9d3c7856544b295007502085d536a7a53ebc3d409dcccf4f97b6aa82bcbcdd98d32193b8acb96818ec08c8730051ce214d7bdf0efea547484aa0050bc43f4cdbbecf3fbbfcb265a1a5bd32618ea946c738c5e9a60d5ed61d72b5488e799e8270f649599d67e5ac7ba8bf90739e39dd93c0a75add9096b10bf7a5a10212a54d9ac6c212294c929891a4583087013b21a84d36c0be0380d8cb292c59f6751785c6e5713beb5755fe687544580d2f0c7a6607b2d5c395d932dfd21c13c885568e68784a150b8e3f39fe52ea095e24faf841b5798da353f6c04a7fb095d161cbce763717ce2e76cc1421aae7b8c6b1a20b43a9ba6b4bc63fa558baf4be073359fd9b6e9da2e31f69171b9b95690f249a2e3d201edc6e29c9e1937bf6d55dcd3d29b2bb571b276f19ad5ee29e3ca29782f03984b47ddfcd85843db7df3b410a67aceeb98cdac592d675a85ebd4e0c4e622cdf17ca44fdbc40a23772b1d667f3d61f93f6cbe838d60b914781890fe6cddc4733222cd3182c5f6ee205d2a6721d7dd0ee52514f6795a43ddc4b283db7aa30ceca8a95f44e33771c07f48ff66467e1a619d21250761afbdc3af6b6bd32c4c594663f61a0cfb35d0bc27f82c7b222669aac519efce1a0ec83d6dc532901f0d64a410c655a918834c8cf095e53ae060b509324b07fb91f841492000156cef0d4a6a89caf917f27e3510015c15b494786ea0b86aadec04adeb2e06d61f900d832214d0b73da46f99b760daa3e01f36da068625aeff6ed9aa99426e249b08f94ed40f88504da03e3826c9384257887541722d9493d992d9b924b07dc8bb212ad526446d197e87060649aca3d55c2f3edd8f7d291b4c3ffba4a6a5f75d54c77b7c77b4d5051ea2e253a1cd40fbad99da16c8e3dcbe57f1e638f7ea120f25dcde7ca32413db643184680bc81b377c50e190767bac6953548821e878f029334b8358cbd22de3890afe94c01a8709d589903726729181e685fc88807208e8ae487d13cce9fbeeee12f55e40cf039ad88e4c7e9ebe19bea948dfa5a278024b75c320a97ad8884b6c1214b9350af95b24601a48426f5507fff0136d4c1334f86b14b0b5356ec9cddb16185a186fc369497232cb4b598ab0b32ef5218eebaba7299c190631807969d7f0f2108b209a5bb413e2fd704c6315d726197c52010b604e5daa8b242bb7c381d7d3c44c43e7d96d1a4e78897c17e81d9d2b9cc09b25416c4bd0eede1773ead2237099b43102604922ac3120da7ef28cf818aba5e655d121d1be3a80c484d96d5916160b30632ae5e79d0349b970764366998d647f0c3b85fadb1d4be84b8612e3d950d5ec00ad00700a5add0d6cf7c9d4f1c845836b248ebb4432df590bed38384d0d5d6403530828db521ba778fa65c00d5fe2cc2091e70063d521a8591e0b7cbf78e8a7efa6ee28e4b6cfe439de4714081b712901d3d8ba867d35c5b6c4b7d0e1f6a17bc8b181d42b9f2ca57efa6ed06a0ec7e8dc8665f59383ec4d150f8dca8a5a637dff362283acaaf08da6ed41b8c40b2a23c65fd6f2dad2b1c69d20788febd3f13531242dae6d919c12112b7839eea1d732cd5907b84b573820a992174219c284517fa0b56c284e99cdad08ae08500923fb2be3120a27f9acaf3790dc5ea2bb11366a8f93c56c6c33cd52be6b08d971b8cb2d20b6a1fa5b1d0f57a15d35d306003b52d8f6d3e4815e509a5144a95f94aba4750c567fac93a5e6af269ce3ae816acc3957ff02e0b3d9e416e4717f6877b1896be2f962a751e75662f8a35d08200fd7f39879e49a96e3be1df15846597327c8baaedae0f4170052295589b4d30ba4ddbe0134b4203ee3388f5db9c5380c6c314f592d53fbe263aaaedf2f58f2a6ec998740b5ade77ea54b5ae3e9d4c4076b1232c9b236d2078e6a583cca29c9146c4da5a7768385ccc21b1151025f0379953eb8ade850059f2e41e850dd2bea5b0412114626c0dde005a6775c9de5216e8e96dc152f827abcb9c31c0275dec2e78ad4a257158f38578ec4fb30ad7c07aa87f7774c8bda8b7b65e5aade0b50c7f8d7d57c356255814d4a775ae7faff8582ca72b2d6f717b98727c996b65609ca3b9c83536167def4c2d0e2f1c8371ab09b9ee0c268a0ace918ca36ddda8da31720aada6cb1356a944d288147d260edc9f8fc48f060d4116355d2d70be5c62a527429a186d64425bd80687d1d009a6344db8bc8c0141791c72fc345eae78f8f4c27f9d1b82ff3c1a904058d528874dd2ca4e26f6c3788ea9e074dffe123a3191afb31f45608e13a3550dea007617d7de7471382701d8f546e4bba73f9ed4cb424fec26259f59ce5187abca6496cba10061f966721b8e9cfc38c73237fb398df5fb70daea24c2e767840f9558066067a3578e393c1f5ce2f0ae0c295c86815aee1392c08972e8084ba6fa6c6fea68c9c72a3fbe11f82fd1baf01fb8ecd57552d7ece6d788e191ed47f53f74462525168a89c3d12dd08b555afc8513e982171160efff4a0ea21aa8d6727db1d862fd8f7c679745032cb0e3e34cc998cb05599a1e3061faea279887a41896bc8f9bd322491497a25c10b321b7a3acf39aba8e9c853eb753235e392dd66435976c655e4e2a34d61f0f33ca819b6d94aa93b12369a0db557dbc57935ebd060e985e38d4b58018d221531b19e5e2f1ea21fee3aac3218def7b309d728deddab82cfc7742b7f0e2203e3bdc19bcf4ab66d88ef8b7e4e2c415a8046cb03b68615c1d6e5853d69d4a13e6b2fee36991bd16cd4e8590d33c746d3b29ce4ae699c7f126859bbecc2efa46320c390f54e11f79a16a5e44a2289d12796fe7bad9c304b365bbba159bf5744c1b4086d6f95da402f6350e5c433925e163809aaba2bd9820490658a11952ac7706080712d180630694e698ee28c4888d0404e40203227eeb6f6e0ade9ee60bc43e9e73f53d344b38fcc4821de254a84f831962b55276cfacdbebb3e4bc099c70ec290a87376908b912b89f6323357ca21f5ba41da56527d926602963470759e604d77302a843fa613402d9474c19d97571ae76962f719a530579f0b0e14a16e32db2bc15e6e40a4906e96d40e7294a07dc2923891c3c428e0045bfec8002a3e60784f1e5695d1fe97dd19435e67a3abc30133cc3e69814c9470a5dc5dc7fa18b4879c06ebfdf733ed66e90221b5b1279f5b5454a4f3e715d5f2d8a27cb621d847504ee6aa05e941f1c87c26834aa53d2ddd7cbef9912550079f8b705b4c3ef21664c0b91f3d6ba6ddb35d52212b553c76efa9756c4be57aad74068d3d05a853928cf70a26f821425be8a6bddf1eaadea14b6103eb0d5dfc3100bd4b6893aecaa153c590470982fb79a7dd775d5fa1f7239f384d68f69b6b404ecd0c55ba844b8b2b80409cc734abd6bb373c915c36e1c3265fc0cb32efab61790c1c356794bf28f046e27f4f0bca2b9b135cf2cc8b25b3495292a43e5a5b3d51d28625236f1ad5a65a5434e7864f64fc0122ae96ab21145a63e79127588b2f99303863b232b211e93b03a6faa70f24f3e4c90f2d7aabc5e6d659f5cb46882f00cdb5f8312a08bb45f76e9118cce9cd431abacc004dbef9f00b7de14126cb798b227982be0d858f2278b876b6f4f7678c90586ce02ece4e3beb550ab2ef72c18ce87981b9bbfdc85e2952b869521f2141fd8f53c5b8f0fa489ad79f396c4bd004d009528b6012747b6f5b49f42485583bcd63bd4cebd09ee8d0a12f70b5eee3231b7f796d01e99fa9df0ab579591aedc73d8331cf4b0e794ca80a55f567dbc95e655c57ff4c487badca3d474a29fc11616ff13a44b6a92bc105843f0f36979b9a8c52e86b6484b30862a0c9a8821da1bc41f345afcdbe5147c582ecda0e6ac2883cdb7a3cb32f6038d9cd01a52fc1ca3cc09359815a9c4a740b513ef368a5a90c5d84f7d3e14c5a6306c7ea6cc596703eddd5c764417198b4550397e6333b3ebd33766f2b2ac9ce877ee14f363b7806ccfe6d80911751c973d61f5de077b34b1492e3786a766cf3f72829bf0b0de5389241b900761488e35c8791ebad147b8e96deb29ba37d6b2eb86815d6088ef1c4fcd473acf9d8877cf9ddbb5df7167a37d0bcc0a2359fbbdc4ec9b6810f8f085e4ef9116eff929e15bf920af918c7c799fbec2b9bc5b873f5967e2089e826012aca6bcf5178c125ba084442ae899c632eb543ab4f597354a9da9ac464c41f58c4459777936778186658c2b0db93cc4219e779cc6af86303888cdbe6fcea248860f041a7d3e628afa4313169c81f8ab8ee80ce56097fcfcf0a6fd402400288b9ed8b790cbbbb403ec48ff4b44be771c53fce18995b6fb377439b6c8e257badfd4cab6abff20ccb2b1cc5d72098629cef350ae458b94a017b33613e1a1c3d8f7b8165e61b4bb28b15f5961ab689247c553f21ed50de9177509241d0305f5dfff70141262f6ff2bc09ebfbc68815c5b08fe0b3fc07b23094b1225f8add0033e3ab79ae8af463ff0e5702aa056e27ddbd7dd11ab5b21246a138ab2825513d690a9fb911435a7dc55203fa045fd95335107b30e6a6137e5c58c575b435b0ad2127c1a78c3fa62c40181dd40eea5bac9a196ac9fd6de6024ae3e15aca3c58aa4ff1f8bde4176995d7b4583cd427b8d04cb38e1b298195df4973db017a4c7844ddd6e76ca133bc9440982b1ee59b77d69040c3deaf707d2efaa34e427755ac8b3d7bed91dd2aba6724a3af02f49d172331c024ff48320b4d4e2bbf0fc96626616c5694e4d104e56b343a9f166ca7cc17f90d8476f3556917b18d1265597257897617e153ad604ae40348ac2d7546d1bb882130cca5282b0ec536b94b72a495997c1b5b8575d2ca438c18c40ea7e2c784661742c9c636d21119e3108d96c7552fbdb226ec8249e26ed7374f3f0cff17819b569aca675d794c8739c6ab5f38c931e570553684188b7d293cd449ae63eb833ae91fe28e18ebba3e9c79732da04a3bfc0ebaf8d9a4e2d96e8439937e6986c0aa6932340c8a28ce8d25600311154982d0634ebe70fdd718076c477003e2ba167cc149dfe2fb83aba9211208ec5d730c691fd27bb6c28bb253dd873b98aeccd9a5be02bfb0535baf510ff7351ddd3a69597f3210f00acc86cf12c6e6754edcca609e0d2a908a1d7cd0fe9e5f95199b419033bdeb3d97eeff911d48d711e683bc7fa6ad8f2bb101d042547193872f7fc156d68b9afb8390284f8d4e9ec25e0f18c5269d00a7d9daa2583b53f8c6f297837fccf6c0d3576da1117d45a9ae7d99d9292a551e7b53520f8200bece03485b924eb8d31ad9e4e346fb2a543b9e161c700e0650334ba2f4b599d3d43d1fc17c807786516ab4e42046831a2a8b83990ffe3c0e2b4d16478b776af4c0495b184caaa1d6d2d4e1ca197b861b0643c6834ac1aae52fac2abf7f7a7519b30fc2edad7859edc323153b5e1606ea2b9411cf758567d66fe86a86910ab415a5c480a2291aed44a167e885b84fd18e49b1482e9aa16298ecceb5ba627cebfe5c074e421c5b9c1037652e4c1fb06b3a5509f1a3600361e20ce1af4775996f029177bc00fee56eee0746bb390ef2f465cc33142a52e68678f884c7949245fdf5ac1ed0f96016e14523e0596cb189fb00b697cf185739360a9c9c4c06a41bafcf9ef477ad086035f126dd6b8281bc3e3aecdce78856d3b993e3cf5d967f66b5a5f7802a5efb16c8ba6e0f88d74a8fef54de464e9606a7e7644b8e9baabfbed6cf92a8c9c15e5478bc66124d5b795f803eb063785f06356b98dd26e67955625c727aea9ed10f4c51e2974c47ffd8c1cb5dc3d1accf3c94efa89a49043857141adda0d05df15b37d76965f78590bcd2fbd189993116975b3b5696152f4946b6a900d8abd9d7f05abc2914111df3d56542fe9389d8c313773a04eba8505d7b8161ea9f852e6943feb60eee59d11c34c687890ef34b73f274eaf93ba5b338eb1f6ea9e7bb39c1d1da6cbe0caa448fe4e8258720b14ee1280b8f0eabefead894d074c4ccc020e2ed53729297c1672655493585ea49e8a9b21fbfe8a87ca49ead0175bb160f913606cc824a3eefee2c04666fe8f1756bca2789ba9969c966598f18861a3b94f06eea53658a198cb73950d9f960868d5d13de837f77cf9e58b3f131298be6cdc5e07c55891879f606de832ea9d212c7afde8888f79c7a09e7474fd99e4e9a90df04392e083f8e99f077867f6b8deb503baafa7e7854fe82a351e70b49861bcfc34f2a6bac29ff8c1a0cb01d62d44cb52f3284f58f6fed8666f4f9d24d539899abdcd0f2b167ec7fcd54a61b2041b093e7a141d5eaf2990c9767947534acebf0192a9cb547721acca8a61e657a553ce721b37c219e1d21a9023c0e69196202469dbf128b86b8113111ce498321fd0eb1c39ef048f97133ab48d072dab4e7a5aaa699ec0962068c8bf60133186e2bc0f7050f2cf8e0e2c67bc37a64ec69132018bb61c549279fe919dd9271fb83e1fa5b6ffe8d8d4c58af76440b348057695abfa8f12749cc577a47932a1a0b6e605fa5775dd4b72404054be8e1cbb1f9236a6b7803b8186db205396b6ac77e0b980cf10d9b7b44d51f9ec9d40e2de8f523deaacd007cd1f51b355571f5c0db98b712cf9f1f8b17ecac796cdacb6a569d6c34d0b22ff42fd857621256580dd4c1188d5558f4609d977679a9c671202c8628fef0179f915a256457ca82e8617873b146da25227d7d9bbe5c07fbeb240080f8f7851a3e9c96db0ec3f01a36779137d4eac415dd08858fec6c408a432e568f888271a31565c622d915120b3b3267b8c5af9b483bcac4167ad52832376415dd23f723ca7b1b55f62e635a9630b70adc384d681006ba2675adc63174b49014865acfa8940618719a88d31adb7341483ed0fe7e9dd1b0a1b14dc2498f147ff962fe16d2fd898614e6bb6790172d12cfe52d366510091cfd152cf44af7793f7cef14e0b38a047a3a965d2c0361f68f1dea5ab97b319a04f53874db8ae9387d77d8e4959858f954ea9f0bc7ca53c0b61931db81ac611f1707fa44a913d3ea544de0afc5e83b65aa7564afb0a6b35d9e18c2bbfc4fad67bb0e389607a5b5f371e8207c788dad49438180e83495e42c6e448133c58886e92d25a9a5721fd634c1214af8375651c5bc8022afb84cf34b2cb3bd6d71091215f0ff50f781387b681b033e9f25d9dd09b0d7fd7af0ef57c804c1b1cf2b17919cd25ed96c56e38ea05457f32cbbf4ee00abaea981e52384ae93cc5491b53be73367c8a565288704dab328b9a84cd5631c8b8e34803b874c6f58d4b968fde439ff58556981b6a8806dbfb2269ff74abad970a313c3c82491bcff7f44c41e5a1617a51248c11fea16ababb15bab1cb55645c32fdb93f937eefbe9fa4f35f1517528d09c91aa2518d29ef22af0e4d9be32a56231e16b6232d43b0bcb7b066f530ecd7f813b3f423c03bbfba6a898f51047ffc15f37bbe11582e5eae595b533d5fba3a1606e7ba8df1fa91219b938a9cebff6fa995c3e30a4fa54b52fc70d6a9fe0104d8cef7fe540713d4b756aa98f2329ea7fdb41e83b5b392d1a90eda24bf46db9c07853a24ec696ad806d1a2084cdcc01cc5c516a1e6a216298d668e575e7f58480e261cf7d4a7b0f5c28c6e21f54acad04cc2507703b6adb7f4ca463e7cda9acdd99350fb4130a36804c94907de97e31c610633dc0fbb595a9a6249817bb7f338687af35e0d2542136676220e7691a06510255d8d829cdf8ea5c3b55128c74d493d3626f83c60d53fd296799e730d07fbfb0763a10716128e5e7a80cbd762b269a97f3382bf4466484fa9f20c6c9e5c6b9b3f703d147b2d2659709389166c3ef5a33cdf4ad8318a9cacaaf2ecfbaa6358eb891c16a938a972e48fa58f963efb5fce40fe6f8d39d91397f8391d60d1bb98c1ca1a14d7c35268cf99a16c77376d559c755f5efc21b890e1d76acf0ae7f1a7f668a271960724c154bd338ef9b63fc870de1e07a59c31f7a05532ee3391f8ff27c5c3051c4f56951b747075595907c6f94f12aadca3402aaedc34d62f989b3bd98f66955bc23ef7943e10ba62f2a4d8a98a456ba74223d55fd925a38eb0fdd3dc0c796d13704468dd2b9d6b193c658f576690a9d6d8228a0202a639710aacc2d3be9cac08cb56c1dbce2da356f31d056e3e5e4f863848001f5c950d69b5675dbe7b0dd2351b3ef766fbddf4ed1f516dbaaaa26b13e313a3ca3ecd7ae507609385150fbaa83a39a64c5f079ed100e993edcc2139e821403f80432b9a00f555eb23d072059feb34f426ea3fa8b15af8b23b24ad92a8f1f23b66032b2d9d904d378b429bc6cbf64025cbe204912e5c4a811d69ce622f6f9f18de9d0038c51d7e0e6536af2d4421a8ea3ec26250efa70abc1787133e8c73c4061d5dba6a52e5d43be1af7c9032ccec0260f21befd03e90e0d28bc7713e528a889094dc9acdf9fa0e1074b5a972376a0a0cee1cf6fa595c6370e494399a0ebad7266c45419f5d9b3b4f94e1c60ce33aec95358e21a98b4ad8d70cd655f9d60ce63870ee69d5766cf422bd68421353204be10dc03dfcd2f248c83e6478f9a49f96a336d7c122c41b53782515dbf2994c3d834855d7bea2d5782ef6f782844876fe1c83294723d3cbe524faad53b9243187b34d1fe3c238a64a81dda3feb231095ebfd3e27b630b122cf1014ae68e8a826d2913360b80b2fee845f711564b55604b74647acaf60757cbd2c1e2ff9c9ed9555d716a97ef5b8c0aea170f99d67030e5022af3a9a5de0a768c237840ed1b9d1c2b8f64d3e32efd0d01b5d3107bdca626f9f28aafd1ec5dff2e25a59f076749c9f1a68fbca222a15efa83d78ecc1a8b74adf961b88db549239cef07414f488b32313b01baab3ed7e03aa0e7c6aa4f22d6b10febc6663b1a41beec8c59e4340bd0b006a36783c1dc4fcf0785eaecb1bd24359a639d6fa970c472ed7b390ae194bf25280c66b2ac37de1fbcc9d86224c66038789cd35606c046b15821e805b6c753d764c2ba87833a273574a77930d5760f330e38b29f2375b4ec61a227f282f402a8227999850f6c88e081eda70b885c11c03e71bc2bc86168a954a92e385504d78a8dd854f704b07371f1acaeb1de1467e677f0ae51d060e617bfdd8a33dd531a3730895aec960aa6adec8f14451d3e1a657a74a5679a1712f773b7b2f68cb07e8fb122f6fc919d3c6155e1407d4c1dfbfc7bb7cb5ec6bf37d1eef5b317c7c94f309cabc65ae6eb4240cef08500c26b213c8d7579b2d09f46fe3153b859ca23c199054882ff3b5e222c6e26897ac4437cb99a3571ade037956df88654e759d0635a52ddd75382b89f102fa58f414ae73fe1b4fd2ceee7df8040056c614e3f23d84f8fa036debed90472bf977722ca928c0a018e76a624bf03d9efbdfd1a4143f0a4dc992035afeba3a62c3e1f51e2ee600fd4803013382070e9972d98c7ab82266356d8b2983f46acbe7ffa7781803a961d2ff247024d4039c9fbda2ac7f5b40fac6264c096c49c45b2711b4c153b6e08b3189e46d89787a014b84bea66c522b4721e886aeeb92dc87149db3a99d29db0c2bbbf4db0f2b57a8f4e87a0e2226c2a89f7e01f6668a11b1d22b77469a0295df8cbd558ab1fd1e394ba604f88a3b83a49a7ab5fade9a2b7fac5d3832ef1ff7aa227f81acd1df9b07e53ae8762a0656f910287a2a18a129ae9a69c07d0349c08b3bda8ce0c2cc1206e1a1965340fc72c389d52d65f15347eff0d73f3aa86e4b21b0439793507efc1c00a26db67ad8123094e2b8eff80de8ad4c6a1429ed985356f2ac004810c38fc3305c8eb6a560bb44465adb52d75107171dfa205acf4ac87201c2db146cc81f2769b84ff0b3a7d8a52d4096b1074a8a10c7f7638b6ec9eadef2428445ed5c1f9588513fea211fea7a17efa020a9256448d2733a495dc55d1d46b83d6b07d928f3c56b669ff196e95db0d915c5b5d43da83d2a9f6297ffa07bb275bd0ead202c688297ec956b4f149ed4d7f20a23c11611d538f02178165e20c71e451e4d67e02a677ea421aa95a4e3e5353803086f7445d9ec6afc69bb5c89b1d07ca4275ebac2c4124bf2c4f9f86308f95424d0982f103060d6c68209142f66ad66afb0bf97c04d160483feb938e7d5ff1825d567b3db00f9510a4a23b8e8ab1524c46ae205b8a7c0b37e2c0f62d9272e3088dac6ad5eac6f22d5266a60a055227a80f46001d763d3a1ef502b86f3e787b001006cb78001e3d3749e634df7e353ecab181af937264562f1d3d16cf4fca3c4443d6ca555207504d0bc702e26b9ce55100eb834da459787da0eb0d57b0d6119fe501c540d63ddeba0c5139cc80e1e94fdb8540c4c4721ceaeb90e18a370bd75ff2d9d3190c45023c6463dba48bb0d8ac11c24fb7707557c728ccd313f55a5c6f5b8f0aae353313d7f4318e8340802ca9334f8457f65c6ca9efd2197161866f792e8045568b25447e846d1d6f82ae8fd0c2ef90793fd86312c115ae273e8468c5e53ca984243241a144bcaaab9dd5c380a4eca623dab19e081e9a765e69c77e45b4645d9fa632767a92b87985472cc532312d85246c2943089aa449402883c9471d6d4377d4b8e5a499809a48567f694a1b0141643ba0b4bc0efad43808888304b1a6d6b9eb8b3a3c85a0def33785a40ffad8d072b215129cd37b86c8d89a7874945b6a2302c204ba2ca5c2b0b46e66ad4abd6c53f2197a4aba142a1200059eacd5b3c48002f0c5862119ee27d615b13b8fc6ab1fc41f74aa574c5192f5b9a0aa84ff840926b32730130d2a1a4efe5e0ab62493f6783f1bb051cc8ebed600503010942875b01bf2c1d0c9b7cfdb3e443b40993e1448da5a4346d37377fc2375ae9572b5bbb68f6c34323765e5bfb5dc9ea1f53b79aa63b8fc0007a1f7acde2d6b190f32e251aaf57be72aae3a9539bc3ae66c319858b167318189f223114a3f7e7c2ed81d7a951d545a3ca4f8bba7c866d1fa36e8426cb7261d4a003fdbb7ec82eb49f54aba7d97e7576147e73259ccebba1cbe34dc2860b670a0970c7575a1ceeba5042bf8277d76072a7a4835221ee7a584eae980e4b096592dc59918ac3ddef96dccf0fa982da3d03d158001b1025975cd2a6c381f2f621cb09f5a4ba3f70b30edc515a19d2dc1b2dca39d8bca01157f662bbee9a3a436b1f1194d4f178666c52fef1b32169bc3c9708f2efc0caa7b953e38447eeec5ded23103c50428336751827f1beac81275ff07d2f416b3d461727aaf482d2ab7156b877eaf7d2ea58dc674ba7af9c0633a6b40e2d68bef379a8c0d7753806e9b57acae699aa51b14464fdf84cb1092014d1595520c706aae7dd51deb12ca8a19480a239beccb0b1bc22ea4d1bd93839e9873491458710a513c8a7218ee1db82ed2cc705954f0d678606214e95b0b2ba47efc9ec646cebe02556ac6fe6ba3b4742d4b590f29dda22c787ccf899e0abfd1e74afbdb0cdc15fa04515dc9854eef955e610fabfd8cf305b1a941da02562661b6ade814279115e8daf109859b40fcc95b90d360939e3201ae20fcaf5a256e6a744d0beb52e2bb52f3783952843946fe1ec4c99ed7ab69f5becf09b42be930141cb04ce8a7426f98ed196a61f5612fe986f343a42ba2294a0188e6bbade2b7de1a1ddd079798602035ef2f6fc7afd2e0d4c7526c98791ef51fb050ac528c5a4004d2c3d5d1f2052c6b1d5e75cb1974f1a4bb44fbcc6eb81e3c02995c767a8b7525028dc64856104a6aacad876e579ce2c66cf76dca80c8075c1ce2a23db1feec5bca5b0d9505c73ccc5094d6b78eaf65ece9bdb439cc389691d54a1fa14763393cb1bdda94b6b516b874c6e5b9da60bb66eb447bc8e703f0f7ce13d4adf13c93668630bbbee4fd3bb3d027b12d615a74a6cc76600de92d7a5d2d3d4009deb357e6caabddc2c2419accc7ea1b46856d1d4111632aa0dd991aec9f6284ffadeb44f3254dbef8893bc42b944bc92b55df48de79027a1624e55a63f2ece7a21a4fd5f74fd6ce3f148e084123d749236191b256ec32cfb35a5691d892f03a3f7e43949772cb7849a75be0b4a387b5960cdcacdd28547923d607f1dcd282ec438eb99de4ee8f740f5b043b5cd2157769582a0e775cde193a15497e4aa5f269137d86d5a1a0bb93b499246fca1184fdf94d75f77bc860f5b2c7500d416cd33aa0b413170fb529c68230b054cc387d9549a1b1070652f1992842173075dfb09f901345372b5d971851fcd03ba5178b173dcb056b6747e459e11818192e6995422f416b16be0f4182eccfea05cddd2e8333113a431734a1448ba9037d66db3042418ddaf7241e8fbe9827c7bd7965d3eee72c4787cd2c5ad93525b98081102faae098a6e277f9c8ca948dabdf34570717dd8e4b709a78173ba43d32b3495b5537ccc5168d79dd8003f248bc7007053e32fae6aa11b7fb8de35c8d5031377a6feae9d63285416308ed5ba064f28c85da2ae04a318446cc1084875fc365bc58305d593</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
      <category term="webpack@4+" scheme="https://blog.yanxlg.cn/tags/webpack-4/"/>
    
  </entry>
  
  <entry>
    <title>umi.js</title>
    <link href="https://blog.yanxlg.cn/a96cfee5/"/>
    <id>https://blog.yanxlg.cn/a96cfee5/</id>
    <published>2019-11-06T03:51:44.000Z</published>
    <updated>2020-05-10T10:01:28.821Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="0e109f9497fdf91b93c376f64ab866fb96e2692556bcb8b88746209be690da95">73be6c7b1c3a7288fec0b8ea9b8e4d2e233a55a8be666d691060881b0c311b73d62efc8b1c368e271811838b2f6864bcc66546593b7bdfbefa1a49b93da64661ba4b46ae432a65ada5f4ff029e5f68e11b7066ce9f69cc805445a06ca6376d71f367b51c5330828368fe1871ab6b0a33e1e6504e287a29474ba5c75a27bf23208cc75af6d0e4d2a02bf5a62f944d7c3a6be2f5f62685a31b7abb0de0215b3afecbedc69b08e4134cc83bacccc6afd867e4fc97dd106abe06c3ff81d09d0332d34337ba4908468d39baf89e7c6bd6adc97f0537ed3a1118b94242d0e275de4e593ac19af8d0a56fc19fee00948afe323c714fe3996d03b514e3b44c14b5f573d8db8bc1d7f6db627bfdf83e8ae301a4c4e5b422bbcd0afbfa9ee0db4c652a9fcad6f0df575cc63132b34d013000489491e193247383565be5b19517a4770ebf972a584bea8dcc0f9d90afc0d578b55cd5aca6482b6c050f5d6d16e8441a8fc90db531b32ce774ad26cfa6578f5b93bc8901af84a9839a4cc0448f2c887895ba27e7af397f02cd2d410644eb48448a30ee728497729f2b70e907368e1ca7d9d486f329e9a2eeb3d5ece26d065b992ac696ca884a502b27d5aa019cb6c3daa98807faa2897607d1b2e498d6ee7ba8046f58a5205b0ef831c3011c98b6b2380e42cce3955d749392fab4e2b34e4203f353e39880e74d9cf21754d3dbedce83558bd451c3a0eeabf75041fa08743b3ae51476b9538b36e0453c31e794e5090aa83072651d36fdcb612c930cd7c8a8791f1c2019ab609031c9f8595e1f37ff1ab2b2a0ab98745e5a27a052f51cd5539f0806effbca125b0f1f103137505d25a85e9466</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>图片懒加载</title>
    <link href="https://blog.yanxlg.cn/f0e261b6/"/>
    <id>https://blog.yanxlg.cn/f0e261b6/</id>
    <published>2019-11-04T08:10:35.000Z</published>
    <updated>2020-02-27T01:44:45.741Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着H5页面图片资源的丰富，首屏页面加载效率受到明显限制，因此优化图片加载成为一个重要的需求，而图片的优化，除了压缩、缓存外，还有一个重要的方式是<code>懒加载</code>。本文主要介绍<code>懒加载</code>的实现方案及思路。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>懒加载</code>从字面看，<code>就是我比较懒，你催我要的时候我才加载，不然我就罢工休息</code>，因此主要的做法就是一开始不显示图片，在需要的时候我才加载并显示图片。什么时候才是需要的时候呢？从UI交互上讲就是图片所在的元素容器显示在viewport上的时候。因此设计方案如下：</p><h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><ol><li>默认情况下<code>img</code>标签不设置<code>src</code>属性，仅做占位使用。</li><li>当该<code>img</code>元素被移动到可视区域<code>viewport</code>中时设置其<code>src</code>属性为需要访问的图片地址。</li><li>图片显示后回收对该图片的监听，释放资源</li></ol><p>第一步比较简单，在js或者模板中，生成<code>img</code>时，使用<code>data-src</code>属性替代<code>src</code>属性即可，关键是第二步和第三步，如何去监听及释放。<br>从掌握的前端知识中可以发现，有两种方式可以实现上面的逻辑：</p><h2 id="方案一：Observer"><a href="#方案一：Observer" class="headerlink" title="方案一：Observer"></a>方案一：Observer</h2><p>详细了解浏览器<a href="/e4278974/" title="Observer">Observer</a>的用法，我们可以发现有一个<code>Intersection Observer</code>能够观察元素位置，同时支持取消观察的API，满足当前需求，因此可以实现为：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-lazyload</span> <span class="attr">data-src</span>=<span class="string">"img-1.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-lazyload</span> <span class="attr">data-src</span>=<span class="string">"img-2.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-lazyload</span> <span class="attr">data-src</span>=<span class="string">"img-3.jpg"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- more images --&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> callback = <span class="function">(<span class="params">entries, observer</span>)=&gt;</span> &#123;</span><br><span class="line">    entries.forEach(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">        entry.target.src = entry.target.dataset.src;</span><br><span class="line">        observer.unobserve(entry.target);<span class="comment">// 取消观察</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> lazyLoadObserver = <span class="keyword">new</span> IntersectionObserver(callback);</span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">'[data-lazyload]'</span>).forEach(<span class="function"><span class="params">img</span> =&gt;</span> &#123; lazyLoadObserver.observe(img) &#125;);</span><br></pre></td></tr></table></figure><p>到此，基本功能已经实现了，可以看到代码非常简单，配合相关的框架生成html的方式使用即可，但是经过测验会发现，图片在滚动到<code>viewport</code>中时，会存在较长时间的无图现象，对于用户感知来说，不太友好，因此需要将观察区域进行延伸，修改为如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> callback = <span class="function">(<span class="params">entries, observer</span>)=&gt;</span> &#123;</span><br><span class="line">    entries.forEach(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">        entry.target.src = entry.target.dataset.src;</span><br><span class="line">        observer.unobserve(entry.target);<span class="comment">// 取消观察</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> lazyLoadObserver = <span class="keyword">new</span> IntersectionObserver(callback,&#123;rootMargin:<span class="string">"-50px 0 -50px 0"</span>&#125;);</span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">'[data-lazyload]'</span>).forEach(<span class="function"><span class="params">img</span> =&gt;</span> &#123; lazyLoadObserver.observe(img) &#125;);</span><br></pre></td></tr></table></figure><p>添加<code>rootMargin</code>参数，将观察区域相对于<code>root</code>进行放大，滚动时，当图片元素具体可视区域上或者下50px的位置时即可触发观察回调，此时立即进行图片加载，在一定的程度上，当用户将该图片滚动到可视区域中时，可能已经加载完成；具体的偏移值需要根据图片服务情况及用户网络情况确定。<br>将上述代码用于项目中会发现，部分环境<code>IntersectionObserver</code>报错，这是由于兼容性造成，<a href="/e4278974/" title="Observer">Observer</a>中详细介绍了其兼容性并提供了<code>polyfill</code>方案，其<code>polyfill</code>和下面第二种方案类似。</p><h2 id="方案二：onscroll-getComputedStyle"><a href="#方案二：onscroll-getComputedStyle" class="headerlink" title="方案二：onscroll + getComputedStyle"></a>方案二：onscroll + getComputedStyle</h2><p>传统js中判断元素与可视区域之间的位置关系用<code>getBoundingClientRect</code>API 来实现，因此，我们可以使用<code>轮询判断</code>的方式去进行元素探测，使用<code>onscroll</code>+<code>getBoundingClientRect</code>实现该功能：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imgs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'[data-lazyload]'</span>);</span><br><span class="line"><span class="keyword">const</span> callback = <span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    imgs.forEach(<span class="function">(<span class="params">img:HTMLImageElement</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!img.src)&#123;</span><br><span class="line">            <span class="keyword">const</span> position = img.getBoundingClientRect();</span><br><span class="line">            <span class="keyword">if</span>(position.bottom&gt;=<span class="number">-50</span>||position&lt;=<span class="built_in">window</span>.innerHeight+<span class="number">50</span>)&#123;</span><br><span class="line">                img.src = img.dataset.src;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"scroll"</span>,callback);</span><br></pre></td></tr></table></figure><p>代码相当简单，但是<code>并不实用</code>，主要存在以下问题：<br>    - <code>onscroll</code>触发太过频繁，每次触发都去进行dom List的遍历，开销很大<br>    - <code>getBoundingClientRect</code>容易造成浏览器重绘<br>    - <code>onscroll</code>在IOS中并不会频繁触发，只在开始和结束触发一次</p><p>根据以上问题，需要对此进行优化：<br>    - 通过<code>throttle</code>或<code>debounce</code>优化<code>onscroll</code>的频繁触发<br>    - 当<code>onscroll</code>触发不正常时，即判断IOS环境，使用<code>requestAnimationFrame</code>无限轮询代替<code>onscroll</code><br>优化代码此处不作提现，经过上面的优化，该方案可用性才明显提升。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul><li>image 初始不要设置src属性，即使设置为<code>&quot;&quot;</code>或者<code>undefined</code>也不要，可能会造成重复载入，不同浏览器行为不一致</li></ul><h2 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化"></a>其他优化</h2><ul><li>通过滚动距离进行节流</li><li>滚动暂停时才开始触发探测回调</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>常见的一下lazyload插件主要采用的是方案二的方式，只是或多或少在此基础上做了进一步优化，但是其效率仍然比不上方案一，建议使用方案一，实在不兼容的情况下使用方案二。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;随着H5页面图片资源的丰富，首屏页面加载效率受到明显限制，因此优化图片加载成为一个重要的需求，而图片的优化，除了压缩、缓存外，还有一个重要的
      
    
    </summary>
    
    
      <category term="h5" scheme="https://blog.yanxlg.cn/categories/h5/"/>
    
      <category term="lib" scheme="https://blog.yanxlg.cn/categories/h5/lib/"/>
    
    
      <category term="h5" scheme="https://blog.yanxlg.cn/tags/h5/"/>
    
      <category term="lib" scheme="https://blog.yanxlg.cn/tags/lib/"/>
    
      <category term="lazyload" scheme="https://blog.yanxlg.cn/tags/lazyload/"/>
    
  </entry>
  
  <entry>
    <title>前端埋点实现</title>
    <link href="https://blog.yanxlg.cn/8e6ad7f6/"/>
    <id>https://blog.yanxlg.cn/8e6ad7f6/</id>
    <published>2019-11-04T05:41:54.000Z</published>
    <updated>2020-05-12T10:12:17.309Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="96cbead502dcd47c34223d83f69c780d0529a3bfb32915325f8d3db969675f76">640bbc83c3d2118e2d9ab6cb0d84d75cc1f99989018ea69d617cb7da84144a356de7b98f14e20b94318bcd9dd68ce28ee7feba4952cd534cfdea93c44aba537c1b61ff712b4350bb20e3069760333a1ccb7a24dd5c27cbf29baf831e51c390e97649c3454aed119157cf1c4f80c965b0a35233806d3740dae194b76de08f24be604ac43251ae852ae3374b154ccafbc8707f5dd7eae4869bc91b18f07fb47853349da07782a1e5d8fe90834704c76cb957d37d8fe9bf590e5d289d7f9fc3fbd32122aa00fba6ccfd8ae44cdd60bea6ca2ef958d7668a7bc5f6783602bf6f1ba4d1a08c9e8080d632f2fa3fd3eb08170f73719f9d36ca5d918241da7a15abedf90f1f61af1d312a1b139ecc8937cf87b49cac6e561f34d13c17a948f9979b080ea746e97a4193507915c0ef4e8873ffdd1701e34475a891f495f1cc25cd303f3b16a39c473976dfc559b5593495405a09</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Tree Structure</title>
    <link href="https://blog.yanxlg.cn/e06277db/"/>
    <id>https://blog.yanxlg.cn/e06277db/</id>
    <published>2019-11-04T03:25:35.000Z</published>
    <updated>2020-02-27T01:44:45.740Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="h5" scheme="https://blog.yanxlg.cn/categories/h5/"/>
    
      <category term="data structure" scheme="https://blog.yanxlg.cn/categories/h5/data-structure/"/>
    
    
      <category term="data structure" scheme="https://blog.yanxlg.cn/tags/data-structure/"/>
    
      <category term="algorithm" scheme="https://blog.yanxlg.cn/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Babel</title>
    <link href="https://blog.yanxlg.cn/7056c18d/"/>
    <id>https://blog.yanxlg.cn/7056c18d/</id>
    <published>2019-11-04T02:38:39.000Z</published>
    <updated>2020-05-12T10:12:00.925Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="密码错误，请输入正确的密码." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">本文暂不开放，需要密码才可阅读.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="3c096ca89b65d78527ec9495674f119f0e6db4c9ce16304505cb161e0347d75d">19b62e44b0797489d08ffe84a9ee044b876eb51016c21e05ccc8a35518b4ca21d1b2039b045a1779bb5ae18652df1ab58d65b62e8a93ac227e08f4c1708ce4cbfc72e1600fefbc2c8756936e94cf79990cedee46a69732b257e8150f468a7c581dc04d1e8d69242ddd34d005398b9723329a57d8f8a8459b8cc6a667f711ba474ab06a2c763e317902158df6364ea027a78b60efcf6a3f1258113ef9772b76ddac03ea7b01ded5c106f69cd7c490a62afffa249368d2838b8d04ffb360f195a36dc8ef93452d31ab5b459c6ca14aed9f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
    
  </entry>
  
</feed>
